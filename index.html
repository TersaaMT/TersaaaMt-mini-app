<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TersaaMt</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://s3.tradingview.com/tv.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDCoJorMymAl8rijf3q7fLxVnw9ERtIDdA",
            authDomain: "mini-app-d344f.firebaseapp.com",
            projectId: "mini-app-d344f",
            storageBucket: "mini-app-d344f.firebasestorage.app",
            messagingSenderId: "459391636486",
            appId: "1:459391636486:web:fcebe891bbb14e5dfd5f87"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.db = db;
        window.firestoreUtils = { collection, addDoc, getDocs };
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0e27; color: #ffffff; min-height: 100vh; overflow-x: hidden;
        }
        body::before, body::after {
            content: ''; position: fixed; top: 0; width: 50px; height: 50px;
            border-top: 3px solid #1a237e; border-radius: 8px; z-index: 5;
        }
        body::before { left: 0; border-left: 3px solid #1a237e; border-top-left-radius: 8px; }
        body::after { right: 0; border-right: 3px solid #1a237e; border-top-right-radius: 8px; }
        
        .header {
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(79, 172, 254, 0.2);
        }
        .logo {
            font-size: 28px; font-weight: 900; letter-spacing: 1px;
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .invite-btn, .settings-btn {
            width: 36px; height: 36px; border: none; border-radius: 10px;
            color: #ffffff; cursor: pointer; display: flex; align-items: center;
            justify-content: center; font-size: 16px; transition: all 0.3s ease;
        }
        .invite-btn { background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%); }
        .settings-btn { background: rgba(255, 255, 255, 0.1); }
        .invite-btn:hover, .settings-btn:hover { transform: scale(1.05); }

        .container { padding: 20px; padding-bottom: 100px; }
        .auth-screen { max-width: 400px; margin: 50px auto; padding: 30px; position: relative; }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è —á–∞—Å—Ç–∏—Ü –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ */
        #particles-js {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a3a 50%, #0a0e27 100%);
            z-index: 1;
        }

        /* –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        .energy-animation {
            position: relative; width: 300px; height: 300px; margin: 50px auto;
            display: flex; align-items: center; justify-content: center;
        }
        
        .energy-orb {
            width: 200px; height: 200px; position: relative;
            background: radial-gradient(circle, rgba(0, 255, 100, 0.3) 0%, rgba(0, 200, 80, 0.1) 50%, transparent 100%);
            border-radius: 50%; animation: pulse 2s infinite ease-in-out;
        }
        
        .energy-ring {
            position: absolute; border-radius: 50%;
            border: 2px solid rgba(0, 255, 100, 0.6);
            animation: rotate 4s linear infinite;
        }
        
        .energy-ring:nth-child(1) {
            width: 150px; height: 150px; top: -75px; left: -75px;
            animation-duration: 3s;
        }
        
        .energy-ring:nth-child(2) {
            width: 200px; height: 200px; top: -100px; left: -100px;
            animation-duration: 4s; animation-direction: reverse;
        }
        
        .energy-ring:nth-child(3) {
            width: 250px; height: 250px; top: -125px; left: -125px;
            animation-duration: 5s;
        }
        
        .energy-particles {
            position: absolute; width: 100%; height: 100%;
        }
        
        .energy-particle {
            position: absolute; width: 4px; height: 4px;
            background: rgba(0, 255, 100, 0.8);
            border-radius: 50%;
            animation: float 3s infinite ease-in-out;
        }
        
        .energy-particle:nth-child(1) { top: 20%; left: 30%; animation-delay: 0s; }
        .energy-particle:nth-child(2) { top: 70%; left: 20%; animation-delay: 0.5s; }
        .energy-particle:nth-child(3) { top: 40%; left: 80%; animation-delay: 1s; }
        .energy-particle:nth-child(4) { top: 80%; left: 70%; animation-delay: 1.5s; }
        .energy-particle:nth-child(5) { top: 10%; left: 60%; animation-delay: 2s; }
        
        .energy-center {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 48px; z-index: 10;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) scale(1); opacity: 0.7; }
            25% { transform: translateY(-10px) scale(1.2); opacity: 1; }
            50% { transform: translateY(-20px) scale(0.8); opacity: 0.5; }
            75% { transform: translateY(-10px) scale(1.1); opacity: 0.9; }
        }
        .auth-title { text-align: center; margin-bottom: 30px; font-size: 28px; font-weight: bold; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 500; color: #b8c5d1; }
        .form-input, .form-select {
            width: 100%; padding: 15px; border: none; border-radius: 12px;
            background: rgba(255, 255, 255, 0.05); color: #ffffff; font-size: 16px;
            transition: all 0.3s ease;
        }
        .form-input:focus, .form-select:focus {
            outline: none; background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.3);
        }
        .btn-primary {
            width: 100%; padding: 15px; background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            border: none; border-radius: 12px; color: #ffffff; font-size: 18px;
            font-weight: bold; cursor: pointer; transition: all 0.3s ease; margin-top: 20px;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(79, 172, 254, 0.4); }

        .page { display: none; }
        .page.active { display: block; }
        .section { border-radius: 20px; padding: 25px; margin-bottom: 20px; position: relative; }
        .section::before {
            content: ''; position: absolute; top: 0; left: 20px; right: 20px; height: 2px;
            background: linear-gradient(90deg, transparent 0%, rgba(79, 172, 254, 0.3) 15%, 
                        rgba(79, 172, 254, 0.6) 30%, rgba(0, 242, 254, 0.8) 50%, 
                        rgba(79, 172, 254, 0.6) 70%, rgba(79, 172, 254, 0.3) 85%, transparent 100%);
        }
        .section-title { font-size: 24px; font-weight: bold; margin-bottom: 20px; color: #4facfe; }

        .crypto-ticker {
            width: 100%; background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(15px);
            border-radius: 12px; padding: 12px 0; margin: 20px 0; overflow: hidden;
            position: relative; border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .crypto-ticker-content { display: flex; animation: scroll-left 30s linear infinite; }
        .crypto-item {
            display: inline-flex; align-items: center; margin-right: 35px; font-size: 13px;
            color: #ffffff; font-weight: 500; background: rgba(255, 255, 255, 0.05);
            padding: 8px 12px; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .crypto-icon {
            width: 20px; height: 20px; border-radius: 50%; margin-right: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; font-weight: bold; color: #ffffff;
        }
        .crypto-price { color: #00c851; font-weight: 600; }
        .crypto-change { color: #00c851; font-size: 11px; margin-left: 4px; }
        .crypto-change.negative { color: #ff4444; }

        .video-lessons-section {
            position: relative; padding: 25px; margin-bottom: 20px;
        }
        .video-lessons-section::before, .video-lessons-section::after {
            content: ''; position: absolute; left: 20px; right: 20px; height: 1px;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 215, 0, 0.3) 20%, 
                        rgba(255, 215, 0, 0.8) 50%, rgba(255, 215, 0, 0.3) 80%, transparent 100%);
        }
        .video-lessons-section::before { top: 0; }
        .video-lessons-section::after { bottom: 0; }
        .video-lessons-title {
            font-size: 20px; font-weight: bold; text-align: center;
            color: #ffd700; margin-bottom: 30px;
        }
        .video-item {
            background: rgba(255, 255, 255, 0.08); border-radius: 15px;
            padding: 20px; margin-bottom: 15px; cursor: pointer;
            transition: all 0.3s ease; position: relative;
        }
        .video-item::before {
            content: ''; position: absolute; left: 0; top: 20px; bottom: 20px; width: 3px;
            background: linear-gradient(180deg, rgba(79, 172, 254, 0.2) 0%, 
                        rgba(79, 172, 254, 0.6) 50%, rgba(79, 172, 254, 0.2) 100%);
            border-radius: 2px;
        }
        .video-item:hover { transform: translateY(-3px); background: rgba(255, 255, 255, 0.12); }
        .video-title { font-size: 16px; font-weight: bold; margin-bottom: 8px; color: #00f2fe; }

        .coin-selector {
            display: flex; gap: 10px; padding: 15px 20px; margin-bottom: 20px;
            overflow-x: auto; -webkit-overflow-scrolling: touch;
        }
        .coin-btn {
            min-width: 80px; padding: 8px 15px; border: none; border-radius: 20px;
            font-size: 12px; font-weight: bold; cursor: pointer; transition: all 0.3s ease;
            display: flex; align-items: center; gap: 5px; white-space: nowrap;
        }
        .coin-btn.active {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            color: #ffffff; box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        }
        .coin-btn:not(.active) {
            background: rgba(255, 255, 255, 0.1); color: #b8c5d1;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .signal-indicator {
            display: inline-block; padding: 8px 15px; border-radius: 20px;
            font-size: 14px; font-weight: bold; margin: 10px 0;
        }
        .signal-buy { background: linear-gradient(45deg, #00c851, #007e33); color: white; }
        .signal-sell { background: linear-gradient(45deg, #ff4444, #cc0000); color: white; }
        .signal-neutral { background: linear-gradient(45deg, #ffbb33, #ff8800); color: white; }

        .strategy-card {
            padding: 20px; margin-bottom: 25px; cursor: pointer; transition: all 0.3s ease;
            position: relative; background: transparent; border-radius: 0;
        }
        .strategy-card::before {
            content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent 0%, transparent 15%, 
                        var(--strategy-color, #4facfe) 20%, var(--strategy-color, #4facfe) 80%, 
                        transparent 85%, transparent 100%);
        }
        .strategy-card:hover { transform: translateY(-2px); }
        .strategy-title { font-size: 18px; font-weight: bold; color: var(--strategy-color); }
        .strategy-ma14 { --strategy-color: #00c851; }
        .strategy-trendline { --strategy-color: #ff6b35; }
        .strategy-channel { --strategy-color: #9c27b0; }

        .news-item {
            background: rgba(255, 255, 255, 0.08); border-radius: 15px;
            padding: 20px; margin-bottom: 15px; transition: all 0.3s ease;
        }
        .news-title { font-size: 16px; font-weight: bold; margin-bottom: 8px; color: #ffffff; }
        .news-summary { color: #b8c5d1; font-size: 14px; line-height: 1.5; }
        .news-date { color: #4facfe; font-size: 12px; margin-top: 10px; }

        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(10, 14, 39, 0.95); backdrop-filter: blur(20px);
            display: flex; justify-content: space-around; padding: 15px 0; z-index: 1000;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; cursor: pointer;
            transition: all 0.3s ease; padding: 8px; border-radius: 12px; min-width: 70px;
        }
        .nav-item:hover, .nav-item.active {
            background: rgba(79, 172, 254, 0.2); transform: translateY(-2px);
        }
        .nav-icon { font-size: 20px; margin-bottom: 5px; }
        .nav-label { font-size: 11px; font-weight: 500; }

        .settings-dropdown {
            position: absolute; top: 60px; right: 20px;
            background: rgba(10, 14, 39, 0.95); border-radius: 15px; padding: 20px;
            backdrop-filter: blur(20px); display: none; z-index: 200; min-width: 250px;
            border: 1px solid rgba(79, 172, 254, 0.3);
        }
        .settings-section { margin-bottom: 20px; }
        .settings-title {
            font-size: 14px; font-weight: bold; color: #4facfe; margin-bottom: 10px;
            display: flex; align-items: center; gap: 8px;
        }
        .settings-option {
            display: flex; align-items: center; padding: 10px; cursor: pointer;
            border-radius: 8px; transition: all 0.3s ease; margin-bottom: 5px;
        }
        .settings-option:hover { background: rgba(255, 255, 255, 0.1); }
        .promo-input {
            width: 100%; padding: 10px; border: none; border-radius: 8px;
            background: rgba(255, 255, 255, 0.1); color: #ffffff;
            font-size: 14px; margin-bottom: 10px;
        }
        .promo-btn {
            width: 100%; padding: 8px; background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            border: none; border-radius: 8px; color: #ffffff; font-size: 12px;
            font-weight: bold; cursor: pointer; transition: all 0.3s ease;
        }

        .floating-back-btn {
            position: fixed; top: 70px; left: 20px; width: 40px; height: 40px;
            background: rgba(10, 14, 39, 0.9); border: none; border-radius: 50%;
            color: #ffffff; cursor: pointer; display: none; align-items: center;
            justify-content: center; font-size: 18px; transition: all 0.3s ease;
            backdrop-filter: blur(10px); z-index: 200;
        }
        .floating-back-btn.show { display: flex; }
        .floating-back-btn:hover { background: rgba(79, 172, 254, 0.9); transform: scale(1.1); }

        .admin-panel {
            position: fixed; bottom: 100px; right: 20px; background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3); border-radius: 10px;
            padding: 15px; display: none; z-index: 150;
        }
        .admin-btn {
            background: linear-gradient(45deg, #ff4444, #cc0000); color: white;
            border: none; padding: 8px 15px; border-radius: 5px;
            font-size: 12px; cursor: pointer; margin: 5px;
        }

        .live-signals-container { max-height: 300px; overflow-y: auto; }
        .signal-item {
            background: rgba(255, 255, 255, 0.08); border-radius: 10px;
            padding: 15px; margin-bottom: 10px;
            border-left: 3px solid var(--signal-color, #4facfe);
        }

        @keyframes scroll-left {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        @media (max-width: 480px) {
            .container { padding: 15px; padding-bottom: 100px; }
            .auth-screen { margin: 20px auto; padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">TersaaMt</div>
        <div class="header-right">
            <button class="invite-btn" onclick="inviteFriend()" title="–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M3 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2" fill="none"/>
                    <line x1="17" y1="11" x2="17" y2="17" stroke="currentColor" stroke-width="2"/>
                </svg>
            </button>
            <button class="invite-btn" onclick="showProfile()" title="–ü—Ä–æ—Ñ–∏–ª—å">üë§</button>
            <button class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
        </div>
        
        <div class="settings-dropdown" id="settingsDropdown">
            <div class="settings-section">
                <div class="settings-title">üî§ –Ø–∑—ã–∫</div>
                <div class="settings-option" onclick="setLanguage('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</div>
                <div class="settings-option" onclick="setLanguage('en')">üá¨üáß English</div>
                <div class="settings-option" onclick="setLanguage('uz')">üá∫üáø O'zbek</div>
                <div class="settings-option" onclick="setLanguage('ja')">üáØüáµ Japanese</div>
            </div>
            <div class="settings-section">
                <div class="settings-title">üìâ –¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞</div>
                <div class="settings-option" onclick="setChartType('candles')">üïØÔ∏è –Ø–ø–æ–Ω—Å–∫–∏–µ —Å–≤–µ—á–∏</div>
                <div class="settings-option" onclick="setChartType('bars')">üìä –ë–∞—Ä—ã</div>
            </div>
            <div class="settings-section">
                <div class="settings-title">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥</div>
                <input type="text" class="promo-input" id="promoInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
                <button class="promo-btn" onclick="activatePromo()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            <div class="settings-section">
                <div class="settings-title">‚ùì FAQ</div>
                <div class="settings-option" onclick="showFAQ()">üìã –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã</div>
            </div>
        </div>
    </div>

    <button class="floating-back-btn" id="floatingBackBtn" onclick="goBack()">‚Üê</button>

    <div id="adminPanel" class="admin-panel">
        <div style="color: #ff4444; font-weight: bold; margin-bottom: 10px;">ADMIN</div>
        <button class="admin-btn" onclick="showLiveSignals()">–°–∏–≥–Ω–∞–ª—ã</button>
        <button class="admin-btn" onclick="exportData()">–≠–∫—Å–ø–æ—Ä—Ç</button>
    </div>

    <div id="authScreen" class="auth-screen">
        <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω —Å —á–∞—Å—Ç–∏—Ü–∞–º–∏ -->
        <div id="particles-js"></div>
        
        <h1 class="auth-title" style="position: relative; z-index: 10;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ TersaaMt</h1>
        <form id="authForm" style="position: relative; z-index: 10;">
            <div class="form-group">
                <label class="form-label">–ò–º—è</label>
                <input type="text" class="form-input" id="firstName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>
            </div>
            <div class="form-group">
                <label class="form-label">–§–∞–º–∏–ª–∏—è</label>
                <input type="text" class="form-input" id="lastName" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é" required>
            </div>
            <div class="form-group">
                <label class="form-label">–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                <input type="number" class="form-input" id="birthYear" placeholder="1990" min="1950" max="2010" required>
            </div>
            <div class="form-group">
                <label class="form-label">–û–ø—ã—Ç –≤ —Ç—Ä–µ–π–¥–∏–Ω–≥–µ</label>
                <select class="form-select" id="experience" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—ã—Ç</option>
                    <option value="beginner">–ù–æ–≤–∏—á–æ–∫ (0-6 –º–µ—Å—è—Ü–µ–≤)</option>
                    <option value="intermediate">–°—Ä–µ–¥–Ω–∏–π (6 –º–µ—Å—è—Ü–µ–≤ - 2 –≥–æ–¥–∞)</option>
                    <option value="advanced">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π (2-5 –ª–µ—Ç)</option>
                    <option value="expert">–≠–∫—Å–ø–µ—Ä—Ç (5+ –ª–µ—Ç)</option>
                </select>
            </div>
            <button type="submit" class="btn-primary">–ù–∞—á–∞—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é</button>
        </form>
    </div>

    <div id="mainApp" style="display: none;">
        <div class="container">
            <div id="homePage" class="page active">
                <!-- –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –≤–º–µ—Å—Ç–æ –≤–∏–¥–µ–æ —É—Ä–æ–∫–æ–≤ -->
                <div class="section" style="text-align: center;">
                    <h2 class="section-title">üöÄ TersaaMt Analytics</h2>
                    
                    <div class="energy-animation">
                        <div class="energy-orb">
                            <div class="energy-ring"></div>
                            <div class="energy-ring"></div>
                            <div class="energy-ring"></div>
                            <div class="energy-particles">
                                <div class="energy-particle"></div>
                                <div class="energy-particle"></div>
                                <div class="energy-particle"></div>
                                <div class="energy-particle"></div>
                                <div class="energy-particle"></div>
                            </div>
                        </div>
                        <div class="energy-center">üß†</div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="color: #00f2fe; margin-bottom: 20px;">–°–∏—Å—Ç–µ–º–∞ –ò–ò-–∞–Ω–∞–ª–∏–∑–∞ –∞–∫—Ç–∏–≤–Ω–∞</h3>
                        <p style="color: #b8c5d1; line-height: 1.6; max-width: 400px; margin: 0 auto;">
                            –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ 
                            –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ—á–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤.
                        </p>
                    </div>
                </div>

                <!-- –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã–π —Ç–∏–∫–µ—Ä —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ -->
                <div class="crypto-ticker">
                    <div class="crypto-ticker-content">
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #f7931a, #ffb74d);">‚Çø</div>
                            <span style="margin-right: 6px; font-weight: 600;">BTC</span>
                            <span class="crypto-price" id="btcPrice">$0</span>
                            <span class="crypto-change" id="btcChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #627eea, #8fa4f3);">Œû</div>
                            <span style="margin-right: 6px; font-weight: 600;">ETH</span>
                            <span class="crypto-price" id="ethPrice">$0</span>
                            <span class="crypto-change" id="ethChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #f3ba2f, #fdd835);">B</div>
                            <span style="margin-right: 6px; font-weight: 600;">BNB</span>
                            <span class="crypto-price" id="bnbPrice">$0</span>
                            <span class="crypto-change" id="bnbChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #9945ff, #14f195);">‚óé</div>
                            <span style="margin-right: 6px; font-weight: 600;">SOL</span>
                            <span class="crypto-price" id="solPrice">$0</span>
                            <span class="crypto-change" id="solChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #23292f, #4a5568);">‚äó</div>
                            <span style="margin-right: 6px; font-weight: 600;">XRP</span>
                            <span class="crypto-price" id="xrpPrice">$0</span>
                            <span class="crypto-change" id="xrpChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #0033ad, #3f51b5);">‚Ç≥</div>
                            <span style="margin-right: 6px; font-weight: 600;">ADA</span>
                            <span class="crypto-price" id="adaPrice">$0</span>
                            <span class="crypto-change" id="adaChange">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –í–∏–¥–µ–æ —É—Ä–æ–∫–∏ -->
            <div id="lessonsPage" class="page">
                <div class="video-lessons-section">
                    <h2 class="video-lessons-title">üìö –í–∏–¥–µ–æ —É—Ä–æ–∫–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</h2>
                    <div id="lessonsContainer">
                        <div class="video-item" onclick="playVideo('basic-analysis')">
                            <div class="video-title">üìà –û—Å–Ω–æ–≤—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</div>
                            <div style="color: #b8c5d1; font-size: 14px;">–ò–∑—É—á–∞–µ–º –±–∞–∑–æ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ Bitcoin</div>
                        </div>
                        <div class="video-item" onclick="playVideo('ma14-strategy')">
                            <div class="video-title">üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è MA14 –≤ –¥–µ–ª–µ</div>
                            <div style="color: #b8c5d1; font-size: 14px;">–ñ–∏–≤–æ–π –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –Ω–∞ Ethereum</div>
                        </div>
                        <div class="video-item" onclick="playVideo('risk-management')">
                            <div class="video-title">‚öñÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏</div>
                            <div style="color: #b8c5d1; font-size: 14px;">–ó–∞—â–∏—Ç–∞ –∫–∞–ø–∏—Ç–∞–ª–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ</div>
                        </div>
                        <div class="video-item" onclick="playVideo('market-psychology')">
                            <div class="video-title">üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è —Ä—ã–Ω–∫–∞</div>
                            <div style="color: #b8c5d1; font-size: 14px;">–ü–æ–Ω–∏–º–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ä—ã–Ω–∫–∞</div>
                        </div>
                        <div class="video-item" onclick="playVideo('advanced-patterns')">
                            <div class="video-title">üîç –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã</div>
                            <div style="color: #b8c5d1; font-size: 14px;">–°–ª–æ–∂–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="strategiesPage" class="page">
                <div class="coin-selector">
                    <button class="coin-btn active" onclick="selectCoin('BTCUSDT')" data-coin="BTCUSDT">
                        <div style="width: 16px; height: 16px; border-radius: 50%; background: linear-gradient(45deg, #f7931a, #ffb74d); color: white; display: flex; align-items: center; justify-content: center; font-size: 8px; font-weight: bold;">‚Çø</div>
                        BTC
                    </button>
                    <button class="coin-btn" onclick="selectCoin('ETHUSDT')" data-coin="ETHUSDT">
                        <div style="width: 16px; height: 16px; border-radius: 50%; background: linear-gradient(45deg, #627eea, #8fa4f3); color: white; display: flex; align-items: center; justify-content: center; font-size: 8px; font-weight: bold;">Œû</div>
                        ETH
                    </button>
                    <button class="coin-btn" onclick="selectCoin('BNBUSDT')" data-coin="BNBUSDT">
                        <div style="width: 16px; height: 16px; border-radius: 50%; background: linear-gradient(45deg, #f3ba2f, #fdd835); color: white; display: flex; align-items: center; justify-content: center; font-size: 8px; font-weight: bold;">B</div>
                        BNB
                    </button>
                </div>

                <div class="section">
                    <h2 class="section-title">üìà –¢–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h2>
                    
                    <div id="mainChart" style="height: 500px; border-radius: 15px; overflow: hidden; margin: 20px 0;"></div>
                    
                    <div class="section">
                        <h3 style="color: #00c851; margin-bottom: 15px;">üî¥ LIVE –°–∏–≥–Ω–∞–ª—ã</h3>
                        <div id="liveSignalsContainer" class="live-signals-container">
                            <div style="color: #b8c5d1; text-align: center; padding: 20px;">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Å–∏–≥–Ω–∞–ª–æ–≤...</div>
                        </div>
                    </div>
                    
                    <div class="strategy-card strategy-ma14" onclick="showStrategy('ma14')">
                        <div class="strategy-title">MA14 - –°–∫–æ–ª—å–∑—è—â–∞—è —Å—Ä–µ–¥–Ω—è—è</div>
                        <div style="color: #b8c5d1; margin: 10px 0;">–ê–Ω–∞–ª–∏–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ 14-–ø–µ—Ä–∏–æ–¥–Ω–æ–π —Å–∫–æ–ª—å–∑—è—â–µ–π —Å—Ä–µ–¥–Ω–µ–π</div>
                        <div class="signal-indicator signal-neutral" id="ma14Signal">–ê–Ω–∞–ª–∏–∑...</div>
                    </div>
                    
                    <div class="strategy-card strategy-trendline" onclick="showStrategy('trendline')">
                        <div class="strategy-title">–ü—Ä–æ–±–æ–π —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏</div>
                        <div style="color: #b8c5d1; margin: 10px 0;">–¢—Ä–æ–π–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∏ –∫–∞—Å–∞–Ω–∏—è</div>
                        <div class="signal-indicator signal-neutral" id="trendlineSignal">–ê–Ω–∞–ª–∏–∑...</div>
                    </div>
                    
                    <div class="strategy-card strategy-channel" onclick="showStrategy('channel')">
                        <div class="strategy-title">–¢—Ä–µ–Ω–¥–æ–≤—ã–π –∫–∞–Ω–∞–ª</div>
                        <div style="color: #b8c5d1; margin: 10px 0;">–¢–æ—Ä–≥–æ–≤–ª—è –≤ –∫–∞–Ω–∞–ª–µ –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏</div>
                        <div class="signal-indicator signal-neutral" id="channelSignal">–ê–Ω–∞–ª–∏–∑...</div>
                    </div>
                </div>
            </div>

            <div id="strategyDetail" class="page">
                <div class="section">
                    <h2 class="section-title" id="strategyDetailTitle"></h2>
                    <div id="strategyDetailContent"></div>
                </div>
            </div>

            <div id="newsPage" class="page">
                <div class="section">
                    <h2 class="section-title">üì∞ –ö—Ä–∏–ø—Ç–æ –Ω–æ–≤–æ—Å—Ç–∏</h2>
                    <div id="newsContainer">
                        <div style="color: #b8c5d1; text-align: center; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π...</div>
                    </div>
                </div>
            </div>

            <div id="analyticsPage" class="page">
                <div class="section">
                    <h2 class="section-title">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                    
                    <div style="background: rgba(255, 255, 255, 0.08); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="color: #00f2fe; margin-bottom: 15px;">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="color: #b8c5d1;">–ü–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤:</span>
                            <span style="color: #ffffff; font-weight: 500;" id="userSignalsCount">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="color: #b8c5d1;">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π:</span>
                            <span style="color: #ffffff; font-weight: 500;" id="strategiesUsedCount">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #b8c5d1;">–î–Ω–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ:</span>
                            <span style="color: #ffffff; font-weight: 500;" id="daysInSystemCount">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="supportPage" class="page">
                <div class="section">
                    <h2 class="section-title">üõü –ü–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
                    <form id="supportForm">
                        <div class="form-group">
                            <label class="form-label">–ò–º—è</label>
                            <input type="text" class="form-input" id="supportName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–¢–µ–º–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è</label>
                            <input type="text" class="form-input" id="supportSubject" placeholder="–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea class="form-input" id="supportDescription" rows="5" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É –∏–ª–∏ –≤–æ–ø—Ä–æ—Å" required style="resize: vertical; min-height: 120px;"></textarea>
                        </div>
                        <button type="submit" class="btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="showPage('home')">
                <div class="nav-icon">üöÄ</div>
                <div class="nav-label">–ì–ª–∞–≤–Ω–∞—è</div>
            </div>
            <div class="nav-item" onclick="showPage('lessons')">
                <div class="nav-icon">üéì</div>
                <div class="nav-label">–í–∏–¥–µ–æ —É—Ä–æ–∫–∏</div>
            </div>
            <div class="nav-item" onclick="showPage('strategies')">
                <div class="nav-icon">üìà</div>
                <div class="nav-label">–°—Ç—Ä–∞—Ç–µ–≥–∏–∏</div>
            </div>
            <div class="nav-item" onclick="showPage('news')">
                <div class="nav-icon">üì∞</div>
                <div class="nav-label">–ù–æ–≤–æ—Å—Ç–∏</div>
            </div>
            <div class="nav-item" onclick="showPage('analytics')">
                <div class="nav-icon">üìä</div>
                <div class="nav-label">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
            </div>
            <div class="nav-item" onclick="showPage('support')">
                <div class="nav-icon">üõü</div>
                <div class="nav-label">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram?.WebApp || {
            ready: () => {}, expand: () => {}, sendData: (data) => console.log('Data:', data),
            showAlert: (message) => alert(message)
        };
        tg.ready(); tg.expand();

        let userProfile = null, currentPage = 'home', navigationStack = [], currentCoin = 'BTCUSDT';
        let currentChartType = 'candles', currentLanguage = 'ru', strategyManager = null;

        class MarketDataManager {
            constructor() {
                this.ws = null; this.candles = []; this.currentSymbol = 'BTCUSDT';
                this.callbacks = []; this.isConnected = false; this.tickerWs = null;
            }

            async loadHistoricalData(symbol = this.currentSymbol, limit = 100) {
                try {
                    const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=15m&limit=${limit}`;
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    this.candles = data.map(kline => ({
                        time: kline[0], open: parseFloat(kline[1]), high: parseFloat(kline[2]),
                        low: parseFloat(kline[3]), close: parseFloat(kline[4]), volume: parseFloat(kline[5])
                    }));

                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${this.candles.length} —Å–≤–µ—á–µ–π –¥–ª—è ${symbol}`);
                    this.notifyCallbacks('historicalData', this.candles);
                    return this.candles;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                    return [];
                }
            }

            connectTickerWebSocket() {
                if (this.tickerWs) this.tickerWs.close();

                const symbols = ['btcusdt', 'ethusdt', 'bnbusdt', 'solusdt', 'xrpusdt', 'adausdt'];
                const streams = symbols.map(s => `${s}@ticker`).join('/');
                const wsUrl = `wss://stream.binance.com:9443/stream?streams=${streams}`;
                
                this.tickerWs = new WebSocket(wsUrl);
                this.tickerWs.onopen = () => console.log('Ticker WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω');
                this.tickerWs.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        if (data.data) this.updateTickerUI(data.data);
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ Ticker WebSocket:', error);
                    }
                };
                this.tickerWs.onclose = () => {
                    console.log('Ticker WebSocket –æ—Ç–∫–ª—é—á–µ–Ω');
                    setTimeout(() => this.connectTickerWebSocket(), 5000);
                };
            }

            updateTickerUI(ticker) {
                const symbol = ticker.s.toLowerCase();
                const price = parseFloat(ticker.c);
                const change = parseFloat(ticker.P);
                
                const coinMap = {
                    'btcusdt': 'btc', 'ethusdt': 'eth', 'bnbusdt': 'bnb',
                    'solusdt': 'sol', 'xrpusdt': 'xrp', 'adausdt': 'ada'
                };
                
                const coinPrefix = coinMap[symbol];
                if (!coinPrefix) return;
                
                const priceElement = document.getElementById(`${coinPrefix}Price`);
                const changeElement = document.getElementById(`${coinPrefix}Change`);
                
                if (priceElement) {
                    priceElement.textContent = `${price.toFixed(price >= 1 ? 2 : 4)}`;
                }
                
                if (changeElement) {
                    changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                    changeElement.className = `crypto-change ${change >= 0 ? '' : 'negative'}`;
                }
            }

            subscribe(callback) { this.callbacks.push(callback); }
            
            notifyCallbacks(type, data) {
                this.callbacks.forEach(callback => {
                    try { callback(type, data); }
                    catch (error) { console.error('–û—à–∏–±–∫–∞ –≤ callback:', error); }
                });
            }

            setSymbol(symbol) {
                this.currentSymbol = symbol;
                this.candles = [];
                this.loadHistoricalData();
            }
        }

        class MA14Strategy {
            constructor() { this.name = 'MA14'; this.period = 14; }

            calculateMA(candles, period = this.period) {
                if (candles.length < period) return [];
                
                const ma = [];
                for (let i = period - 1; i < candles.length; i++) {
                    let sum = 0;
                    for (let j = i - period + 1; j <= i; j++) {
                        sum += candles[j].close;
                    }
                    ma.push({ time: candles[i].time, value: sum / period });
                }
                return ma;
            }

            analyze(candles) {
                if (candles.length < this.period + 3) {
                    return { signal: 'WAIT', reason: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö' };
                }

                const ma = this.calculateMA(candles);
                const last3Candles = candles.slice(-3);
                
                const allAboveMA = last3Candles.every((candle, index) => {
                    const maIndex = ma.length - 3 + index;
                    return maIndex >= 0 && candle.close > ma[maIndex].value;
                });

                const allBelowMA = last3Candles.every((candle, index) => {
                    const maIndex = ma.length - 3 + index;
                    return maIndex >= 0 && candle.close < ma[maIndex].value;
                });

                const currentPrice = candles[candles.length - 1].close;

                if (allAboveMA) {
                    return { signal: 'BUY', reason: '3 —Å–≤–µ—á–∏ –ø–æ–¥—Ä—è–¥ –∑–∞–∫—Ä—ã–ª–∏—Å—å –≤—ã—à–µ MA14', price: currentPrice };
                } else if (allBelowMA) {
                    return { signal: 'SELL', reason: '3 —Å–≤–µ—á–∏ –ø–æ–¥—Ä—è–¥ –∑–∞–∫—Ä—ã–ª–∏—Å—å –Ω–∏–∂–µ MA14', price: currentPrice };
                } else {
                    return { signal: 'NEUTRAL', reason: '–ù–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è', price: currentPrice };
                }
            }
        }

        class StrategyManager {
            constructor() {
                this.strategies = { ma14: new MA14Strategy() };
                this.signals = [];
                this.marketData = new MarketDataManager();
                this.initializeMarketData();
            }

            initializeMarketData() {
                this.marketData.subscribe((type, data) => {
                    if (type === 'historicalData') this.analyzeHistoricalData(data);
                });

                this.marketData.loadHistoricalData().then(() => {
                    this.marketData.connectTickerWebSocket();
                });
            }

            analyzeHistoricalData(candles) {
                Object.keys(this.strategies).forEach(strategyName => {
                    const strategy = this.strategies[strategyName];
                    const result = strategy.analyze(candles);
                    this.updateStrategyUI(strategyName, result);
                    
                    if (result.signal === 'BUY' || result.signal === 'SELL') {
                        this.addSignal(strategyName, result);
                    }
                });
            }

            updateStrategyUI(strategyName, result) {
                const signalElement = document.getElementById(`${strategyName}Signal`);
                if (!signalElement) return;

                signalElement.className = 'signal-indicator';
                
                if (result.signal === 'BUY') {
                    signalElement.className += ' signal-buy';
                    signalElement.textContent = `üü¢ BUY ${result.price.toFixed(2)}`;
                } else if (result.signal === 'SELL') {
                    signalElement.className += ' signal-sell';
                    signalElement.textContent = `üî¥ SELL ${result.price.toFixed(2)}`;
                } else {
                    signalElement.className += ' signal-neutral';
                    signalElement.textContent = `‚ö™ ${result.signal}`;
                }
            }

            addSignal(strategyName, result) {
                const signal = {
                    id: Date.now(), timestamp: Date.now(), symbol: this.marketData.currentSymbol,
                    strategy: strategyName, signal: result.signal, price: result.price, reason: result.reason
                };

                this.signals.unshift(signal);
                this.updateLiveSignalsUI();
                
                if (window.db && window.firestoreUtils) {
                    window.firestoreUtils.addDoc(
                        window.firestoreUtils.collection(window.db, 'signals'), 
                        { ...signal, userId: userProfile?.firstName || 'anonymous' }
                    ).catch(console.error);
                }
            }

            updateLiveSignalsUI() {
                const container = document.getElementById('liveSignalsContainer');
                if (!container) return;
                
                const signals = this.signals.slice(0, 5);
                
                if (signals.length === 0) {
                    container.innerHTML = '<div style="color: #b8c5d1; text-align: center; padding: 20px;">–û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤...</div>';
                    return;
                }

                let signalsHtml = '';
                signals.forEach(signal => {
                    const time = new Date(signal.timestamp).toLocaleTimeString();
                    let signalColor = signal.signal === 'BUY' ? '#00c851' : '#ff4444';
                    let signalIcon = signal.signal === 'BUY' ? 'üü¢' : 'üî¥';
                    
                    signalsHtml += `
                        <div class="signal-item" style="--signal-color: ${signalColor};">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <div style="color: ${signalColor}; font-weight: bold;">
                                    ${signalIcon} ${signal.strategy.toUpperCase()}: ${signal.signal}
                                </div>
                                <div style="color: #b8c5d1; font-size: 12px;">${time}</div>
                            </div>
                            <div style="color: #ffffff; font-size: 14px; margin-bottom: 5px;">
                                ${signal.symbol} - ${signal.price.toFixed(2)}
                            </div>
                            <div style="color: #b8c5d1; font-size: 12px;">${signal.reason}</div>
                        </div>
                    `;
                });
                
                container.innerHTML = signalsHtml;
            }

            setSymbol(symbol) { this.marketData.setSymbol(symbol); this.signals = []; this.updateLiveSignalsUI(); }
        }

        function checkAuth() {
            const savedProfile = JSON.parse(localStorage.getItem('userProfile') || 'null');
            if (savedProfile) {
                userProfile = savedProfile;
                showMainApp();
                setTimeout(initializeApp, 1000);
            }
        }

        function showMainApp() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            updateUserInterface();
        }

        function updateUserInterface() {
            if (userProfile) {
                const supportNameInput = document.getElementById('supportName');
                if (supportNameInput) {
                    supportNameInput.value = `${userProfile.firstName} ${userProfile.lastName}`;
                }
                updateUserStats();
            }
        }

        function updateUserStats() {
            if (!userProfile) return;
            
            const registrationDate = new Date(userProfile.timestamp);
            const today = new Date();
            const diffDays = Math.ceil(Math.abs(today - registrationDate) / (1000 * 60 * 60 * 24));
            
            const elements = {
                daysInSystemCount: diffDays,
                strategiesUsedCount: localStorage.getItem('strategiesUsedCount') || '0',
                userSignalsCount: localStorage.getItem('userSignalsCount') || '0'
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
        }

        function initializeApp() {
            strategyManager = new StrategyManager();
            loadNews();
            checkAdminRights();
        }

        function checkAdminRights() {
            const isAdmin = ['Shahruza', 'Admin', '–®–∞—Ö—Ä—É–∑–∞'].includes(userProfile?.firstName);
            if (isAdmin) {
                const adminPanel = document.getElementById('adminPanel');
                if (adminPanel) adminPanel.style.display = 'block';
            }
        }

        function loadNews() {
            const newsContainer = document.getElementById('newsContainer');
            if (!newsContainer) return;
            
            const mockNews = [
                {
                    title: "Bitcoin –¥–æ—Å—Ç–∏–≥ –Ω–æ–≤–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞ –≤ $67,000",
                    summary: "–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã–π —Ä—ã–Ω–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç –Ω–∞ —Ñ–æ–Ω–µ –∏–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞.",
                    date: new Date().toISOString()
                },
                {
                    title: "Ethereum –≥–æ—Ç–æ–≤–∏—Ç—Å—è –∫ –∫—Ä—É–ø–Ω–æ–º—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é —Å–µ—Ç–∏",
                    summary: "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ–±—ä—è–≤–∏–ª–∏ –æ –ø–ª–∞–Ω–∞—Ö –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.",
                    date: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString()
                }
            ];

            let newsHtml = '';
            mockNews.forEach(news => {
                const date = new Date(news.date).toLocaleDateString('ru-RU', {
                    day: '2-digit', month: '2-digit', year: 'numeric',
                    hour: '2-digit', minute: '2-digit'
                });
                
                newsHtml += `
                    <div class="news-item">
                        <div class="news-title">${news.title}</div>
                        <div class="news-summary">${news.summary}</div>
                        <div class="news-date">${date}</div>
                    </div>
                `;
            });
            
            newsContainer.innerHTML = newsHtml;
        }

        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                birthYear: parseInt(document.getElementById('birthYear').value),
                experience: document.getElementById('experience').value,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('userProfile', JSON.stringify(formData));
            userProfile = formData;
            
            if (window.db && window.firestoreUtils) {
                try {
                    await window.firestoreUtils.addDoc(
                        window.firestoreUtils.collection(window.db, 'users'), 
                        { ...formData, createdAt: new Date(), premium: false }
                    );
                } catch (error) { console.error('Firebase error:', error); }
            }
            
            tg.sendData(JSON.stringify(formData));
            showMainApp();
            setTimeout(initializeApp, 1000);
        });

        function showPage(pageName) {
            if (pageName !== currentPage) navigationStack.push(currentPage);
            currentPage = pageName;

            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));

            document.getElementById(pageName + 'Page').classList.add('active');

            const navItems = document.querySelectorAll('.nav-item');
            const pageIndex = ['home', 'lessons', 'strategies', 'news', 'analytics', 'support'].indexOf(pageName);
            if (pageIndex !== -1 && navItems[pageIndex]) {
                navItems[pageIndex].classList.add('active');
            }

            updateBackButton();

            if (pageName === 'strategies') {
                setTimeout(() => initTradingViewChart('mainChart'), 100);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ —á–∞—Å—Ç–∏—Ü –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function initParticles() {
            const particlesContainer = document.getElementById('particles-js');
            if (!particlesContainer) return;

            // –°–æ–∑–¥–∞–µ–º —á–∞—Å—Ç–∏—Ü—ã –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
            for (let i = 0; i < 100; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.cssText = `
                    position: absolute;
                    width: 2px;
                    height: 2px;
                    background: rgba(79, 172, 254, ${Math.random() * 0.8 + 0.2});
                    border-radius: 50%;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    animation: particleMove ${Math.random() * 10 + 5}s linear infinite;
                    animation-delay: ${Math.random() * 5}s;
                `;
                particlesContainer.appendChild(particle);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —á–∞—Å—Ç–∏—Ü
            const style = document.createElement('style');
            style.textContent = `
                @keyframes particleMove {
                    0% { transform: translate(0, 0) scale(0); opacity: 0; }
                    10% { opacity: 1; }
                    90% { opacity: 1; }
                    100% { transform: translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px) scale(1); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

        function updateBackButton() {
            const backBtn = document.getElementById('floatingBackBtn');
            if (backBtn) {
                backBtn.classList.toggle('show', navigationStack.length > 0);
            }
        }

        function goBack() {
            if (navigationStack.length > 0) {
                const previousPage = navigationStack.pop();
                showPage(previousPage);
            }
        }

        function selectCoin(symbol) {
            currentCoin = symbol;
            
            document.querySelectorAll('.coin-btn').forEach(btn => btn.classList.remove('active'));
            const activeCoin = document.querySelector(`[data-coin="${symbol}"]`);
            if (activeCoin) activeCoin.classList.add('active');
            
            if (strategyManager) strategyManager.setSymbol(symbol);
            setTimeout(() => initTradingViewChart('mainChart'), 100);
        }

        function showStrategy(strategyType) {
            navigationStack.push(currentPage);
            currentPage = 'strategyDetail';
            
            document.getElementById('strategiesPage').classList.remove('active');
            document.getElementById('strategyDetail').classList.add('active');

            const currentCount = parseInt(localStorage.getItem('strategiesUsedCount') || '0');
            localStorage.setItem('strategiesUsedCount', (currentCount + 1).toString());
            updateUserStats();

            const strategies = {
                ma14: {
                    title: 'MA14 - –°–∫–æ–ª—å–∑—è—â–∞—è —Å—Ä–µ–¥–Ω—è—è',
                    content: `
                        <p><strong>–ü—Ä–∏–Ω—Ü–∏–ø:</strong> –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è —Å–≤–µ—á–µ–π —Å MA14</p>
                        <h3>–ü—Ä–∞–≤–∏–ª–∞ –≤—Ö–æ–¥–∞:</h3>
                        <ul>
                            <li><strong>üü¢ BUY:</strong> 3 —Å–≤–µ—á–∏ –ø–æ–¥—Ä—è–¥ –∑–∞–∫—Ä—ã–ª–∏—Å—å –≤—ã—à–µ MA14</li>
                            <li><strong>üî¥ SELL:</strong> 3 —Å–≤–µ—á–∏ –ø–æ–¥—Ä—è–¥ –∑–∞–∫—Ä—ã–ª–∏—Å—å –Ω–∏–∂–µ MA14</li>
                            <li><strong>‚ö™ NEUTRAL:</strong> –Ω–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</li>
                        </ul>
                    `
                },
                trendline: {
                    title: '–ü—Ä–æ–±–æ–π —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –ª–∏–Ω–∏–∏',
                    content: `
                        <p><strong>–ü—Ä–∏–Ω—Ü–∏–ø:</strong> –¢—Ä–æ–π–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∏ –∫–∞—Å–∞–Ω–∏—è –ª–∏–Ω–∏–π</p>
                        <h3>–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ:</h3>
                        <ol>
                            <li>–ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º—É–º, –º–∏–Ω–∏–º—É–º, –ø–µ—Ä–µ–±–∏—Ç—ã–π –º–∞–∫—Å–∏–º—É–º</li>
                            <li>–°–æ–µ–¥–∏–Ω—è–µ–º —ç–∫—Å—Ç—Ä–µ–º—É–º—ã –ª–∏–Ω–∏–µ–π</li>
                            <li>–ñ–¥–µ–º –ø—Ä–æ–±–æ—è –¥–ª—è –≤—Ö–æ–¥–∞</li>
                        </ol>
                    `
                },
                channel: {
                    title: '–¢—Ä–µ–Ω–¥–æ–≤—ã–π –∫–∞–Ω–∞–ª',
                    content: `
                        <p><strong>–ü—Ä–∏–Ω—Ü–∏–ø:</strong> –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ —á–µ—Ä–µ–∑ —ç–∫—Å—Ç—Ä–µ–º—É–º—ã</p>
                        <p>–¢–æ—Ä–≥–æ–≤–ª—è –Ω–∞ –∫–∞—Å–∞–Ω–∏—è—Ö –≥—Ä–∞–Ω–∏—Ü –∫–∞–Ω–∞–ª–∞</p>
                    `
                }
            };

            const strategy = strategies[strategyType];
            if (strategy) {
                document.getElementById('strategyDetailTitle').textContent = strategy.title;
                document.getElementById('strategyDetailContent').innerHTML = strategy.content;
            }
            
            updateBackButton();
        }

        function initTradingViewChart(containerId) {
            if (typeof TradingView !== 'undefined') {
                new TradingView.widget({
                    "width": "100%", "height": 500,
                    "symbol": `BINANCE:${currentCoin}`,
                    "interval": "15", "timezone": "Asia/Tashkent",
                    "theme": "dark", "style": "1", "locale": "ru",
                    "toolbar_bg": "#0a0e27", "enable_publishing": false,
                    "withdateranges": true, "range": "1D",
                    "hide_side_toolbar": false, "allow_symbol_change": true,
                    "studies": ["MASimple@tv-basicstudies"], "container_id": containerId,
                    "studies_overrides": { "MASimple.length": 14, "MASimple.plot.color": "#00c851" },
                    "overrides": {
                        "paneProperties.background": "#0a0e27",
                        "paneProperties.vertGridProperties.color": "#2a2f4a",
                        "paneProperties.horzGridProperties.color": "#2a2f4a",
                        "mainSeriesProperties.candleStyle.upColor": "#00c851",
                        "mainSeriesProperties.candleStyle.downColor": "#ff4444"
                    }
                });
            }
        }

        function toggleSettings() {
            const dropdown = document.getElementById('settingsDropdown');
            if (dropdown) {
                dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            }
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('selectedLanguage', lang);
            toggleSettings();
            tg.showAlert(`–Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${lang}`);
        }

        function setChartType(type) {
            currentChartType = type;
            localStorage.setItem('chartType', type);
            if (currentPage === 'strategies') {
                setTimeout(() => initTradingViewChart('mainChart'), 100);
            }
            tg.showAlert(`–¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞: ${type === 'candles' ? '–°–≤–µ—á–∏' : '–ë–∞—Ä—ã'}`);
            toggleSettings();
        }

        function activatePromo() {
            const promoInput = document.getElementById('promoInput');
            if (!promoInput) return;
            
            const promoCode = promoInput.value.trim();
            
            if (['TERSAAMT2024', 'PREMIUM', 'VIP'].includes(promoCode)) {
                tg.showAlert('üéâ –ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! Premium –¥–æ—Å—Ç—É–ø –ø–æ–ª—É—á–µ–Ω!');
                localStorage.setItem('premiumAccess', 'true');
                promoInput.value = '';
            } else if (promoCode === '') {
                tg.showAlert('‚ùå –í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥');
            } else {
                tg.showAlert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥');
            }
            toggleSettings();
        }

        function showFAQ() {
            toggleSettings();
            tg.showAlert(`‚ùì FAQ:

1. üìà –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ Binance
2. üü¢üî¥ –°–∏–≥–Ω–∞–ª—ã: BUY/SELL –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ MA14
3. üéÅ –ü—Ä–æ–º–æ–∫–æ–¥—ã: TERSAAMT2024, PREMIUM, VIP
4. üìä –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
5. üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–µ—Ä–µ–∑ —Ä–∞–∑–¥–µ–ª "–ü–æ–¥–¥–µ—Ä–∂–∫–∞"`);
        }

        function inviteFriend() {
            const inviteLink = `https://t.me/TersaaMtBot?start=${userProfile?.firstName || 'user'}_invite`;
            const message = `üöÄ TersaaMt - —Ç–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ Binance!\n\n${inviteLink}`;
            
            if (navigator.share) {
                navigator.share({ title: 'TersaaMt', text: message, url: inviteLink });
            } else {
                navigator.clipboard?.writeText(message).then(() => {
                    tg.showAlert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
                }).catch(() => {
                    tg.showAlert(`–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π:\n${inviteLink}`);
                });
            }
        }

        function showProfile() {
            if (!userProfile) {
                tg.showAlert('–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                return;
            }
            
            const experienceMap = {
                'beginner': '–ù–æ–≤–∏—á–æ–∫ (0-6 –º–µ—Å—è—Ü–µ–≤)',
                'intermediate': '–°—Ä–µ–¥–Ω–∏–π (6 –º–µ—Å—è—Ü–µ–≤ - 2 –≥–æ–¥–∞)',
                'advanced': '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π (2-5 –ª–µ—Ç)',
                'expert': '–≠–∫—Å–ø–µ—Ä—Ç (5+ –ª–µ—Ç)'
            };
            
            const registrationDate = new Date(userProfile.timestamp);
            const diffDays = Math.ceil(Math.abs(new Date() - registrationDate) / (1000 * 60 * 60 * 24));
            const hasPremium = localStorage.getItem('premiumAccess') === 'true';
            const strategiesUsed = localStorage.getItem('strategiesUsedCount') || '0';
            const signalsReceived = localStorage.getItem('userSignalsCount') || '0';
            
            const profileText = `üë§ –ü–†–û–§–ò–õ–¨

–ò–º—è: ${userProfile.firstName} ${userProfile.lastName}
–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è: ${userProfile.birthYear}
–û–ø—ã—Ç: ${experienceMap[userProfile.experience] || userProfile.experience}

üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê
–î–Ω–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ: ${diffDays}
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π: ${strategiesUsed}
–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ —É—Ä–æ–∫–æ–≤: ${signalsReceived}
Premium —Å—Ç–∞—Ç—É—Å: ${hasPremium ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: ${registrationDate.toLocaleDateString('ru-RU')}`;
            
            tg.showAlert(profileText);
        }

        function playVideo(videoId) {
            const videos = {
                'basic-analysis': { title: '–û—Å–Ω–æ–≤—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞', description: '–ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Å –¥–∞–Ω–Ω—ã–º–∏ Bitcoin' },
                'ma14-strategy': { title: '–°—Ç—Ä–∞—Ç–µ–≥–∏—è MA14 –≤ –¥–µ–ª–µ', description: '–ñ–∏–≤–æ–π –ø—Ä–∏–º–µ—Ä –Ω–∞ Ethereum' },
                'risk-management': { title: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏', description: '–ó–∞—â–∏—Ç–∞ –∫–∞–ø–∏—Ç–∞–ª–∞ –≤ —Ç–æ—Ä–≥–æ–≤–ª–µ' }
            };

            const video = videos[videoId];
            if (video) {
                const currentCount = parseInt(localStorage.getItem('userSignalsCount') || '0');
                localStorage.setItem('userSignalsCount', (currentCount + 1).toString());
                updateUserStats();
                
                tg.showAlert(`‚ñ∂Ô∏è ${video.title}\n\n${video.description}\n\n(–í –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –≤–∏–¥–µ–æ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–æ—Ç–∏—Ä–æ–≤–∫–∞–º–∏)`);
            }
        }

        function showLiveSignals() {
            if (!strategyManager || strategyManager.signals.length === 0) {
                tg.showAlert('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤');
                return;
            }
            
            let message = 'üî¥ –ñ–ò–í–´–ï –°–ò–ì–ù–ê–õ–´:\n\n';
            strategyManager.signals.slice(0, 5).forEach(signal => {
                const time = new Date(signal.timestamp).toLocaleTimeString();
                message += `${time} - ${signal.strategy.toUpperCase()}: ${signal.signal} ${signal.price.toFixed(2)}\n`;
            });
            
            tg.showAlert(message);
        }

        function exportData() {
            try {
                const data = {
                    signals: strategyManager ? strategyManager.signals : [],
                    userProfile: userProfile,
                    timestamp: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `tersaamt_data_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                tg.showAlert('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö');
            }
        }

        document.getElementById('supportForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const supportData = {
                name: document.getElementById('supportName').value,
                subject: document.getElementById('supportSubject').value,
                description: document.getElementById('supportDescription').value,
                userProfile: userProfile,
                timestamp: new Date().toISOString()
            };

            try {
                if (window.db && window.firestoreUtils) {
                    await window.firestoreUtils.addDoc(
                        window.firestoreUtils.collection(window.db, 'support_requests'), 
                        supportData
                    );
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞:', error);
            }

            tg.sendData(JSON.stringify(supportData));
            tg.showAlert('–í–∞—à –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.');
            e.target.reset();
            
            document.getElementById('supportName').value = `${userProfile?.firstName || ''} ${userProfile?.lastName || ''}`.trim();
        });

        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('settingsDropdown');
            const settingsBtn = document.querySelector('.settings-btn');
            
            if (dropdown && settingsBtn && !dropdown.contains(e.target) && !settingsBtn.contains(e.target)) {
                dropdown.style.display = 'none';
            }
        });

        if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
            const telegramUser = window.Telegram.WebApp.initDataUnsafe.user;
            
            if (telegramUser.first_name) {
                const firstNameInput = document.getElementById('firstName');
                if (firstNameInput) firstNameInput.value = telegramUser.first_name;
            }
            if (telegramUser.last_name) {
                const lastNameInput = document.getElementById('lastName');
                if (lastNameInput) lastNameInput.value = telegramUser.last_name;
            }
        }

        window.addEventListener('load', () => {
            checkAuth();
            initParticles(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ —á–∞—Å—Ç–∏—Ü –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            
            const savedLanguage = localStorage.getItem('selectedLanguage');
            if (savedLanguage) currentLanguage = savedLanguage;
            
            const savedChartType = localStorage.getItem('chartType');
            if (savedChartType) currentChartType = savedChartType;
        });

        window.addEventListener('DOMContentLoaded', () => {
            console.log('TersaaMt Loading...');
            
            setTimeout(() => {
                if (document.getElementById('mainChart')) {
                    initTradingViewChart('mainChart');
                }
            }, 2000);
        });

        console.log('TersaaMt Trading App v8.0 - –° –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ñ–æ–Ω–æ–º –∏ –Ω–æ–≤–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –≥–æ—Ç–æ–≤–∞! üöÄ');
    </script>
</body>
</html>
