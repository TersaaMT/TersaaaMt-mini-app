<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TersaaMt</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://s3.tradingview.com/tv.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDCoJorMymAl8rijf3q7fLxVnw9ERtIDdA",
            authDomain: "mini-app-d344f.firebaseapp.com",
            projectId: "mini-app-d344f",
            storageBucket: "mini-app-d344f.firebasestorage.app",
            messagingSenderId: "459391636486",
            appId: "1:459391636486:web:fcebe891bbb14e5dfd5f87"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.db = db;
        window.firestoreUtils = { collection, addDoc, getDocs };
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0e27; color: #ffffff; min-height: 100vh; overflow-x: hidden;
        }
        body::before, body::after {
            content: ''; position: fixed; top: 0; width: 50px; height: 50px;
            border-top: 3px solid #1a237e; border-radius: 8px; z-index: 5;
        }
        body::before { left: 0; border-left: 3px solid #1a237e; border-top-left-radius: 8px; }
        body::after { right: 0; border-right: 3px solid #1a237e; border-top-right-radius: 8px; }
        
        .header {
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(79, 172, 254, 0.2);
        }
        .logo {
            font-size: 28px; font-weight: 900; letter-spacing: 1px;
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .invite-btn, .settings-btn {
            width: 36px; height: 36px; border: none; border-radius: 10px;
            color: #ffffff; cursor: pointer; display: flex; align-items: center;
            justify-content: center; font-size: 16px; transition: all 0.3s ease;
        }
        .invite-btn { background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%); }
        .settings-btn { background: rgba(255, 255, 255, 0.1); }
        .invite-btn:hover, .settings-btn:hover { transform: scale(1.05); }

        .container { padding: 20px; padding-bottom: 100px; }
        .auth-screen { max-width: 400px; margin: 50px auto; padding: 30px; position: relative; }
        
        /* Анимация частиц для регистрации */
        #particles-js {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a3a 50%, #0a0e27 100%);
            z-index: 1;
        }

        /* Энергетическая анимация для главной страницы */
        .energy-animation {
            position: relative; width: 300px; height: 300px; margin: 50px auto;
            display: flex; align-items: center; justify-content: center;
        }
        
        .energy-orb {
            width: 200px; height: 200px; position: relative;
            background: radial-gradient(circle, rgba(0, 255, 100, 0.3) 0%, rgba(0, 200, 80, 0.1) 50%, transparent 100%);
            border-radius: 50%; animation: pulse 2s infinite ease-in-out;
        }
        
        .energy-ring {
            position: absolute; border-radius: 50%;
            border: 2px solid rgba(0, 255, 100, 0.6);
            animation: rotate 4s linear infinite;
        }
        
        .energy-ring:nth-child(1) {
            width: 150px; height: 150px; top: -75px; left: -75px;
            animation-duration: 3s;
        }
        
        .energy-ring:nth-child(2) {
            width: 200px; height: 200px; top: -100px; left: -100px;
            animation-duration: 4s; animation-direction: reverse;
        }
        
        .energy-ring:nth-child(3) {
            width: 250px; height: 250px; top: -125px; left: -125px;
            animation-duration: 5s;
        }
        
        .energy-particles {
            position: absolute; width: 100%; height: 100%;
        }
        
        .energy-particle {
            position: absolute; width: 4px; height: 4px;
            background: rgba(0, 255, 100, 0.8);
            border-radius: 50%;
            animation: float 3s infinite ease-in-out;
        }
        
        .energy-particle:nth-child(1) { top: 20%; left: 30%; animation-delay: 0s; }
        .energy-particle:nth-child(2) { top: 70%; left: 20%; animation-delay: 0.5s; }
        .energy-particle:nth-child(3) { top: 40%; left: 80%; animation-delay: 1s; }
        .energy-particle:nth-child(4) { top: 80%; left: 70%; animation-delay: 1.5s; }
        .energy-particle:nth-child(5) { top: 10%; left: 60%; animation-delay: 2s; }
        
        .energy-center {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 48px; z-index: 10;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) scale(1); opacity: 0.7; }
            25% { transform: translateY(-10px) scale(1.2); opacity: 1; }
            50% { transform: translateY(-20px) scale(0.8); opacity: 0.5; }
            75% { transform: translateY(-10px) scale(1.1); opacity: 0.9; }
        }
        .auth-title { text-align: center; margin-bottom: 30px; font-size: 28px; font-weight: bold; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 500; color: #b8c5d1; }
        .form-input, .form-select {
            width: 100%; padding: 15px; border: none; border-radius: 12px;
            background: rgba(255, 255, 255, 0.05); color: #ffffff; font-size: 16px;
            transition: all 0.3s ease;
        }
        .form-input:focus, .form-select:focus {
            outline: none; background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.3);
        }
        .btn-primary {
            width: 100%; padding: 15px; background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            border: none; border-radius: 12px; color: #ffffff; font-size: 18px;
            font-weight: bold; cursor: pointer; transition: all 0.3s ease; margin-top: 20px;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(79, 172, 254, 0.4); }

        .page { display: none; }
        .page.active { display: block; }
        .section { border-radius: 20px; padding: 25px; margin-bottom: 20px; position: relative; }
        .section::before {
            content: ''; position: absolute; top: 0; left: 20px; right: 20px; height: 2px;
            background: linear-gradient(90deg, transparent 0%, rgba(79, 172, 254, 0.3) 15%, 
                        rgba(79, 172, 254, 0.6) 30%, rgba(0, 242, 254, 0.8) 50%, 
                        rgba(79, 172, 254, 0.6) 70%, rgba(79, 172, 254, 0.3) 85%, transparent 100%);
        }
        .section-title { font-size: 24px; font-weight: bold; margin-bottom: 20px; color: #4facfe; }

        .crypto-ticker {
            width: 100%; background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(15px);
            border-radius: 12px; padding: 12px 0; margin: 20px 0; overflow: hidden;
            position: relative; border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .crypto-ticker-content { display: flex; animation: scroll-left 30s linear infinite; }
        .crypto-item {
            display: inline-flex; align-items: center; margin-right: 35px; font-size: 13px;
            color: #ffffff; font-weight: 500; background: rgba(255, 255, 255, 0.05);
            padding: 8px 12px; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .crypto-icon {
            width: 20px; height: 20px; border-radius: 50%; margin-right: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; font-weight: bold; color: #ffffff;
        }
        .crypto-price { color: #00c851; font-weight: 600; }
        .crypto-change { color: #00c851; font-size: 11px; margin-left: 4px; }
        .crypto-change.negative { color: #ff4444; }

        .video-lessons-section {
            position: relative; padding: 25px; margin-bottom: 20px;
        }
        .video-lessons-section::before, .video-lessons-section::after {
            content: ''; position: absolute; left: 20px; right: 20px; height: 1px;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 215, 0, 0.3) 20%, 
                        rgba(255, 215, 0, 0.8) 50%, rgba(255, 215, 0, 0.3) 80%, transparent 100%);
        }
        .video-lessons-section::before { top: 0; }
        .video-lessons-section::after { bottom: 0; }
        .video-lessons-title {
            font-size: 20px; font-weight: bold; text-align: center;
            color: #ffd700; margin-bottom: 30px;
        }
        .video-item {
            background: rgba(255, 255, 255, 0.08); border-radius: 15px;
            padding: 20px; margin-bottom: 15px; cursor: pointer;
            transition: all 0.3s ease; position: relative;
        }
        .video-item::before {
            content: ''; position: absolute; left: 0; top: 20px; bottom: 20px; width: 3px;
            background: linear-gradient(180deg, rgba(79, 172, 254, 0.2) 0%, 
                        rgba(79, 172, 254, 0.6) 50%, rgba(79, 172, 254, 0.2) 100%);
            border-radius: 2px;
        }
        .video-item:hover { transform: translateY(-3px); background: rgba(255, 255, 255, 0.12); }
        .video-title { font-size: 16px; font-weight: bold; margin-bottom: 8px; color: #00f2fe; }

        .coin-selector {
            display: flex; gap: 10px; padding: 15px 20px; margin-bottom: 20px;
            overflow-x: auto; -webkit-overflow-scrolling: touch;
        }
        .coin-btn {
            min-width: 80px; padding: 8px 15px; border: none; border-radius: 20px;
            font-size: 12px; font-weight: bold; cursor: pointer; transition: all 0.3s ease;
            display: flex; align-items: center; gap: 5px; white-space: nowrap;
        }
        .coin-btn.active {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            color: #ffffff; box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        }
        .coin-btn:not(.active) {
            background: rgba(255, 255, 255, 0.1); color: #b8c5d1;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .signal-indicator {
            display: inline-block; padding: 8px 15px; border-radius: 20px;
            font-size: 14px; font-weight: bold; margin: 10px 0;
        }
        .signal-buy { background: linear-gradient(45deg, #00c851, #007e33); color: white; }
        .signal-sell { background: linear-gradient(45deg, #ff4444, #cc0000); color: white; }
        .signal-neutral { background: linear-gradient(45deg, #ffbb33, #ff8800); color: white; }

        .strategy-card {
            padding: 20px; margin-bottom: 25px; cursor: pointer; transition: all 0.3s ease;
            position: relative; background: transparent; border-radius: 0;
        }
        .strategy-card::before {
            content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent 0%, transparent 15%, 
                        var(--strategy-color, #4facfe) 20%, var(--strategy-color, #4facfe) 80%, 
                        transparent 85%, transparent 100%);
        }
        .strategy-card:hover { transform: translateY(-2px); }
        .strategy-title { font-size: 18px; font-weight: bold; color: var(--strategy-color); }
        .strategy-ma14 { --strategy-color: #00c851; }
        .strategy-trendline { --strategy-color: #ff6b35; }
        .strategy-channel { --strategy-color: #9c27b0; }

        .news-item {
            background: rgba(255, 255, 255, 0.08); border-radius: 15px;
            padding: 20px; margin-bottom: 15px; transition: all 0.3s ease;
        }
        .news-title { font-size: 16px; font-weight: bold; margin-bottom: 8px; color: #ffffff; }
        .news-summary { color: #b8c5d1; font-size: 14px; line-height: 1.5; }
        .news-date { color: #4facfe; font-size: 12px; margin-top: 10px; }

        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(10, 14, 39, 0.95); backdrop-filter: blur(20px);
            display: flex; justify-content: space-around; padding: 15px 0; z-index: 1000;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; cursor: pointer;
            transition: all 0.3s ease; padding: 8px; border-radius: 12px; min-width: 70px;
        }
        .nav-item:hover, .nav-item.active {
            background: rgba(79, 172, 254, 0.2); transform: translateY(-2px);
        }
        .nav-icon { font-size: 20px; margin-bottom: 5px; }
        .nav-label { font-size: 11px; font-weight: 500; }

        .settings-dropdown {
            position: absolute; top: 60px; right: 20px;
            background: rgba(10, 14, 39, 0.95); border-radius: 15px; padding: 20px;
            backdrop-filter: blur(20px); display: none; z-index: 200; min-width: 250px;
            border: 1px solid rgba(79, 172, 254, 0.3);
        }
        .settings-section { margin-bottom: 20px; }
        .settings-title {
            font-size: 14px; font-weight: bold; color: #4facfe; margin-bottom: 10px;
            display: flex; align-items: center; gap: 8px;
        }
        .settings-option {
            display: flex; align-items: center; padding: 10px; cursor: pointer;
            border-radius: 8px; transition: all 0.3s ease; margin-bottom: 5px;
        }
        .settings-option:hover { background: rgba(255, 255, 255, 0.1); }
        .promo-input {
            width: 100%; padding: 10px; border: none; border-radius: 8px;
            background: rgba(255, 255, 255, 0.1); color: #ffffff;
            font-size: 14px; margin-bottom: 10px;
        }
        .promo-btn {
            width: 100%; padding: 8px; background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            border: none; border-radius: 8px; color: #ffffff; font-size: 12px;
            font-weight: bold; cursor: pointer; transition: all 0.3s ease;
        }

        .floating-back-btn {
            position: fixed; top: 70px; left: 20px; width: 40px; height: 40px;
            background: rgba(10, 14, 39, 0.9); border: none; border-radius: 50%;
            color: #ffffff; cursor: pointer; display: none; align-items: center;
            justify-content: center; font-size: 18px; transition: all 0.3s ease;
            backdrop-filter: blur(10px); z-index: 200;
        }
        .floating-back-btn.show { display: flex; }
        .floating-back-btn:hover { background: rgba(79, 172, 254, 0.9); transform: scale(1.1); }

        .admin-panel {
            position: fixed; bottom: 100px; right: 20px; background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3); border-radius: 10px;
            padding: 15px; display: none; z-index: 150;
        }
        .admin-btn {
            background: linear-gradient(45deg, #ff4444, #cc0000); color: white;
            border: none; padding: 8px 15px; border-radius: 5px;
            font-size: 12px; cursor: pointer; margin: 5px;
        }

        .live-signals-container { max-height: 300px; overflow-y: auto; }
        .signal-item {
            background: rgba(255, 255, 255, 0.08); border-radius: 10px;
            padding: 15px; margin-bottom: 10px;
            border-left: 3px solid var(--signal-color, #4facfe);
        }

        @keyframes scroll-left {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        @media (max-width: 480px) {
            .container { padding: 15px; padding-bottom: 100px; }
            .auth-screen { margin: 20px auto; padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">TersaaMt</div>
        <div class="header-right">
            <button class="invite-btn" onclick="inviteFriend()" title="Пригласить друга">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M3 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2" fill="none"/>
                    <line x1="17" y1="11" x2="17" y2="17" stroke="currentColor" stroke-width="2"/>
                </svg>
            </button>
            <button class="invite-btn" onclick="showProfile()" title="Профиль">👤</button>
            <button class="settings-btn" onclick="toggleSettings()">⚙️</button>
        </div>
        
        <div class="settings-dropdown" id="settingsDropdown">
            <div class="settings-section">
                <div class="settings-title">🔤 Язык</div>
                <div class="settings-option" onclick="setLanguage('ru')">🇷🇺 Русский</div>
                <div class="settings-option" onclick="setLanguage('en')">🇬🇧 English</div>
                <div class="settings-option" onclick="setLanguage('uz')">🇺🇿 O'zbek</div>
                <div class="settings-option" onclick="setLanguage('ja')">🇯🇵 Japanese</div>
            </div>
            <div class="settings-section">
                <div class="settings-title">📉 Тип графика</div>
                <div class="settings-option" onclick="setChartType('candles')">🕯️ Японские свечи</div>
                <div class="settings-option" onclick="setChartType('bars')">📊 Бары</div>
            </div>
            <div class="settings-section">
                <div class="settings-title">🎁 Промокод</div>
                <input type="text" class="promo-input" id="promoInput" placeholder="Введите промокод">
                <button class="promo-btn" onclick="activatePromo()">Активировать</button>
            </div>
            <div class="settings-section">
                <div class="settings-title">❓ FAQ</div>
                <div class="settings-option" onclick="showFAQ()">📋 Часто задаваемые вопросы</div>
            </div>
        </div>
    </div>

    <button class="floating-back-btn" id="floatingBackBtn" onclick="goBack()">←</button>

    <div id="adminPanel" class="admin-panel">
        <div style="color: #ff4444; font-weight: bold; margin-bottom: 10px;">ADMIN</div>
        <button class="admin-btn" onclick="showLiveSignals()">Сигналы</button>
        <button class="admin-btn" onclick="exportData()">Экспорт</button>
    </div>

    <div id="authScreen" class="auth-screen">
        <!-- Анимированный фон с частицами -->
        <div id="particles-js"></div>
        
        <h1 class="auth-title" style="position: relative; z-index: 10;">Добро пожаловать в TersaaMt</h1>
        <form id="authForm" style="position: relative; z-index: 10;">
            <div class="form-group">
                <label class="form-label">Имя</label>
                <input type="text" class="form-input" id="firstName" placeholder="Введите имя" required>
            </div>
            <div class="form-group">
                <label class="form-label">Фамилия</label>
                <input type="text" class="form-input" id="lastName" placeholder="Введите фамилию" required>
            </div>
            <div class="form-group">
                <label class="form-label">Год рождения</label>
                <input type="number" class="form-input" id="birthYear" placeholder="1990" min="1950" max="2010" required>
            </div>
            <div class="form-group">
                <label class="form-label">Опыт в трейдинге</label>
                <select class="form-select" id="experience" required>
                    <option value="">Выберите опыт</option>
                    <option value="beginner">Новичок (0-6 месяцев)</option>
                    <option value="intermediate">Средний (6 месяцев - 2 года)</option>
                    <option value="advanced">Продвинутый (2-5 лет)</option>
                    <option value="expert">Эксперт (5+ лет)</option>
                </select>
            </div>
            <button type="submit" class="btn-primary">Начать торговлю</button>
        </form>
    </div>

    <div id="mainApp" style="display: none;">
        <div class="container">
            <div id="homePage" class="page active">
                <!-- Энергетическая анимация вместо видео уроков -->
                <div class="section" style="text-align: center;">
                    <h2 class="section-title">🚀 TersaaMt Analytics</h2>
                    
                    <div class="energy-animation">
                        <div class="energy-orb">
                            <div class="energy-ring"></div>
                            <div class="energy-ring"></div>
                            <div class="energy-ring"></div>
                            <div class="energy-particles">
                                <div class="energy-particle"></div>
                                <div class="energy-particle"></div>
                                <div class="energy-particle"></div>
                                <div class="energy-particle"></div>
                                <div class="energy-particle"></div>
                            </div>
                        </div>
                        <div class="energy-center">🧠</div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="color: #00f2fe; margin-bottom: 20px;">Система ИИ-анализа активна</h3>
                        <p style="color: #b8c5d1; line-height: 1.6; max-width: 400px; margin: 0 auto;">
                            Искусственный интеллект анализирует рыночные данные в реальном времени 
                            для создания точных торговых сигналов.
                        </p>
                    </div>
                </div>

                <!-- Криптовалютный тикер с реальными данными -->
                <div class="crypto-ticker">
                    <div class="crypto-ticker-content">
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #f7931a, #ffb74d);">₿</div>
                            <span style="margin-right: 6px; font-weight: 600;">BTC</span>
                            <span class="crypto-price" id="btcPrice">$0</span>
                            <span class="crypto-change" id="btcChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #627eea, #8fa4f3);">Ξ</div>
                            <span style="margin-right: 6px; font-weight: 600;">ETH</span>
                            <span class="crypto-price" id="ethPrice">$0</span>
                            <span class="crypto-change" id="ethChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #f3ba2f, #fdd835);">B</div>
                            <span style="margin-right: 6px; font-weight: 600;">BNB</span>
                            <span class="crypto-price" id="bnbPrice">$0</span>
                            <span class="crypto-change" id="bnbChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #9945ff, #14f195);">◎</div>
                            <span style="margin-right: 6px; font-weight: 600;">SOL</span>
                            <span class="crypto-price" id="solPrice">$0</span>
                            <span class="crypto-change" id="solChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #23292f, #4a5568);">⊗</div>
                            <span style="margin-right: 6px; font-weight: 600;">XRP</span>
                            <span class="crypto-price" id="xrpPrice">$0</span>
                            <span class="crypto-change" id="xrpChange">0%</span>
                        </div>
                        <div class="crypto-item">
                            <div class="crypto-icon" style="background: linear-gradient(45deg, #0033ad, #3f51b5);">₳</div>
                            <span style="margin-right: 6px; font-weight: 600;">ADA</span>
                            <span class="crypto-price" id="adaPrice">$0</span>
                            <span class="crypto-change" id="adaChange">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Новая страница Видео уроки -->
            <div id="lessonsPage" class="page">
                <div class="video-lessons-section">
                    <h2 class="video-lessons-title">📚 Видео уроки с реальными данными</h2>
                    <div id="lessonsContainer">
                        <div class="video-item" onclick="playVideo('basic-analysis')">
                            <div class="video-title">📈 Основы технического анализа</div>
                            <div style="color: #b8c5d1; font-size: 14px;">Изучаем базовые принципы с актуальными данными Bitcoin</div>
                        </div>
                        <div class="video-item" onclick="playVideo('ma14-strategy')">
                            <div class="video-title">🎯 Стратегия MA14 в деле</div>
                            <div style="color: #b8c5d1; font-size: 14px;">Живой пример работы на Ethereum</div>
                        </div>
                        <div class="video-item" onclick="playVideo('risk-management')">
                            <div class="video-title">⚖️ Управление рисками</div>
                            <div style="color: #b8c5d1; font-size: 14px;">Защита капитала в реальной торговле</div>
                        </div>
                        <div class="video-item" onclick="playVideo('market-psychology')">
                            <div class="video-title">🧠 Психология рынка</div>
                            <div style="color: #b8c5d1; font-size: 14px;">Понимание поведения участников рынка</div>
                        </div>
                        <div class="video-item" onclick="playVideo('advanced-patterns')">
                            <div class="video-title">🔍 Продвинутые паттерны</div>
                            <div style="color: #b8c5d1; font-size: 14px;">Сложные фигуры технического анализа</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="strategiesPage" class="page">
                <div class="coin-selector">
                    <button class="coin-btn active" onclick="selectCoin('BTCUSDT')" data-coin="BTCUSDT">
                        <div style="width: 16px; height: 16px; border-radius: 50%; background: linear-gradient(45deg, #f7931a, #ffb74d); color: white; display: flex; align-items: center; justify-content: center; font-size: 8px; font-weight: bold;">₿</div>
                        BTC
                    </button>
                    <button class="coin-btn" onclick="selectCoin('ETHUSDT')" data-coin="ETHUSDT">
                        <div style="width: 16px; height: 16px; border-radius: 50%; background: linear-gradient(45deg, #627eea, #8fa4f3); color: white; display: flex; align-items: center; justify-content: center; font-size: 8px; font-weight: bold;">Ξ</div>
                        ETH
                    </button>
                    <button class="coin-btn" onclick="selectCoin('BNBUSDT')" data-coin="BNBUSDT">
                        <div style="width: 16px; height: 16px; border-radius: 50%; background: linear-gradient(45deg, #f3ba2f, #fdd835); color: white; display: flex; align-items: center; justify-content: center; font-size: 8px; font-weight: bold;">B</div>
                        BNB
                    </button>
                </div>

                <div class="section">
                    <h2 class="section-title">📈 Торговые стратегии</h2>
                    
                    <div id="mainChart" style="height: 500px; border-radius: 15px; overflow: hidden; margin: 20px 0;"></div>
                    
                    <div class="section">
                        <h3 style="color: #00c851; margin-bottom: 15px;">🔴 LIVE Сигналы</h3>
                        <div id="liveSignalsContainer" class="live-signals-container">
                            <div style="color: #b8c5d1; text-align: center; padding: 20px;">Инициализация системы сигналов...</div>
                        </div>
                    </div>
                    
                    <div class="strategy-card strategy-ma14" onclick="showStrategy('ma14')">
                        <div class="strategy-title">MA14 - Скользящая средняя</div>
                        <div style="color: #b8c5d1; margin: 10px 0;">Анализ на основе 14-периодной скользящей средней</div>
                        <div class="signal-indicator signal-neutral" id="ma14Signal">Анализ...</div>
                    </div>
                    
                    <div class="strategy-card strategy-trendline" onclick="showStrategy('trendline')">
                        <div class="strategy-title">Пробой трендовой линии</div>
                        <div style="color: #b8c5d1; margin: 10px 0;">Тройное движение и касания</div>
                        <div class="signal-indicator signal-neutral" id="trendlineSignal">Анализ...</div>
                    </div>
                    
                    <div class="strategy-card strategy-channel" onclick="showStrategy('channel')">
                        <div class="strategy-title">Трендовый канал</div>
                        <div style="color: #b8c5d1; margin: 10px 0;">Торговля в канале между уровнями</div>
                        <div class="signal-indicator signal-neutral" id="channelSignal">Анализ...</div>
                    </div>
                </div>
            </div>

            <div id="strategyDetail" class="page">
                <div class="section">
                    <h2 class="section-title" id="strategyDetailTitle"></h2>
                    <div id="strategyDetailContent"></div>
                </div>
            </div>

            <div id="newsPage" class="page">
                <div class="section">
                    <h2 class="section-title">📰 Крипто новости</h2>
                    <div id="newsContainer">
                        <div style="color: #b8c5d1; text-align: center; padding: 20px;">Загрузка актуальных новостей...</div>
                    </div>
                </div>
            </div>

            <div id="analyticsPage" class="page">
                <div class="section">
                    <h2 class="section-title">📊 Аналитика и статистика</h2>
                    
                    <div style="background: rgba(255, 255, 255, 0.08); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="color: #00f2fe; margin-bottom: 15px;">Ваша статистика</h4>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="color: #b8c5d1;">Полученных сигналов:</span>
                            <span style="color: #ffffff; font-weight: 500;" id="userSignalsCount">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="color: #b8c5d1;">Использовано стратегий:</span>
                            <span style="color: #ffffff; font-weight: 500;" id="strategiesUsedCount">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #b8c5d1;">Дней в системе:</span>
                            <span style="color: #ffffff; font-weight: 500;" id="daysInSystemCount">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="supportPage" class="page">
                <div class="section">
                    <h2 class="section-title">🛟 Поддержка</h2>
                    <form id="supportForm">
                        <div class="form-group">
                            <label class="form-label">Имя</label>
                            <input type="text" class="form-input" id="supportName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Тема обращения</label>
                            <input type="text" class="form-input" id="supportSubject" placeholder="Кратко опишите проблему" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Описание</label>
                            <textarea class="form-input" id="supportDescription" rows="5" placeholder="Подробно опишите вашу проблему или вопрос" required style="resize: vertical; min-height: 120px;"></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Отправить запрос</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="showPage('home')">
                <div class="nav-icon">🚀</div>
                <div class="nav-label">Главная</div>
            </div>
            <div class="nav-item" onclick="showPage('lessons')">
                <div class="nav-icon">🎓</div>
                <div class="nav-label">Видео уроки</div>
            </div>
            <div class="nav-item" onclick="showPage('strategies')">
                <div class="nav-icon">📈</div>
                <div class="nav-label">Стратегии</div>
            </div>
            <div class="nav-item" onclick="showPage('news')">
                <div class="nav-icon">📰</div>
                <div class="nav-label">Новости</div>
            </div>
            <div class="nav-item" onclick="showPage('analytics')">
                <div class="nav-icon">📊</div>
                <div class="nav-label">Аналитика</div>
            </div>
            <div class="nav-item" onclick="showPage('support')">
                <div class="nav-icon">🛟</div>
                <div class="nav-label">Поддержка</div>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram?.WebApp || {
            ready: () => {}, expand: () => {}, sendData: (data) => console.log('Data:', data),
            showAlert: (message) => alert(message)
        };
        tg.ready(); tg.expand();

        let userProfile = null, currentPage = 'home', navigationStack = [], currentCoin = 'BTCUSDT';
        let currentChartType = 'candles', currentLanguage = 'ru', strategyManager = null;

        class MarketDataManager {
            constructor() {
                this.ws = null; this.candles = []; this.currentSymbol = 'BTCUSDT';
                this.callbacks = []; this.isConnected = false; this.tickerWs = null;
            }

            async loadHistoricalData(symbol = this.currentSymbol, limit = 100) {
                try {
                    const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=15m&limit=${limit}`;
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    this.candles = data.map(kline => ({
                        time: kline[0], open: parseFloat(kline[1]), high: parseFloat(kline[2]),
                        low: parseFloat(kline[3]), close: parseFloat(kline[4]), volume: parseFloat(kline[5])
                    }));

                    console.log(`Загружено ${this.candles.length} свечей для ${symbol}`);
                    this.notifyCallbacks('historicalData', this.candles);
                    return this.candles;
                } catch (error) {
                    console.error('Ошибка загрузки данных:', error);
                    return [];
                }
            }

            connectTickerWebSocket() {
                if (this.tickerWs) this.tickerWs.close();

                const symbols = ['btcusdt', 'ethusdt', 'bnbusdt', 'solusdt', 'xrpusdt', 'adausdt'];
                const streams = symbols.map(s => `${s}@ticker`).join('/');
                const wsUrl = `wss://stream.binance.com:9443/stream?streams=${streams}`;
                
                this.tickerWs = new WebSocket(wsUrl);
                this.tickerWs.onopen = () => console.log('Ticker WebSocket подключен');
                this.tickerWs.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        if (data.data) this.updateTickerUI(data.data);
                    } catch (error) {
                        console.error('Ошибка Ticker WebSocket:', error);
                    }
                };
                this.tickerWs.onclose = () => {
                    console.log('Ticker WebSocket отключен');
                    setTimeout(() => this.connectTickerWebSocket(), 5000);
                };
            }

            updateTickerUI(ticker) {
                const symbol = ticker.s.toLowerCase();
                const price = parseFloat(ticker.c);
                const change = parseFloat(ticker.P);
                
                const coinMap = {
                    'btcusdt': 'btc', 'ethusdt': 'eth', 'bnbusdt': 'bnb',
                    'solusdt': 'sol', 'xrpusdt': 'xrp', 'adausdt': 'ada'
                };
                
                const coinPrefix = coinMap[symbol];
                if (!coinPrefix) return;
                
                const priceElement = document.getElementById(`${coinPrefix}Price`);
                const changeElement = document.getElementById(`${coinPrefix}Change`);
                
                if (priceElement) {
                    priceElement.textContent = `${price.toFixed(price >= 1 ? 2 : 4)}`;
                }
                
                if (changeElement) {
                    changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                    changeElement.className = `crypto-change ${change >= 0 ? '' : 'negative'}`;
                }
            }

            subscribe(callback) { this.callbacks.push(callback); }
            
            notifyCallbacks(type, data) {
                this.callbacks.forEach(callback => {
                    try { callback(type, data); }
                    catch (error) { console.error('Ошибка в callback:', error); }
                });
            }

            setSymbol(symbol) {
                this.currentSymbol = symbol;
                this.candles = [];
                this.loadHistoricalData();
            }
        }

        class MA14Strategy {
            constructor() { this.name = 'MA14'; this.period = 14; }

            calculateMA(candles, period = this.period) {
                if (candles.length < period) return [];
                
                const ma = [];
                for (let i = period - 1; i < candles.length; i++) {
                    let sum = 0;
                    for (let j = i - period + 1; j <= i; j++) {
                        sum += candles[j].close;
                    }
                    ma.push({ time: candles[i].time, value: sum / period });
                }
                return ma;
            }

            analyze(candles) {
                if (candles.length < this.period + 3) {
                    return { signal: 'WAIT', reason: 'Недостаточно данных' };
                }

                const ma = this.calculateMA(candles);
                const last3Candles = candles.slice(-3);
                
                const allAboveMA = last3Candles.every((candle, index) => {
                    const maIndex = ma.length - 3 + index;
                    return maIndex >= 0 && candle.close > ma[maIndex].value;
                });

                const allBelowMA = last3Candles.every((candle, index) => {
                    const maIndex = ma.length - 3 + index;
                    return maIndex >= 0 && candle.close < ma[maIndex].value;
                });

                const currentPrice = candles[candles.length - 1].close;

                if (allAboveMA) {
                    return { signal: 'BUY', reason: '3 свечи подряд закрылись выше MA14', price: currentPrice };
                } else if (allBelowMA) {
                    return { signal: 'SELL', reason: '3 свечи подряд закрылись ниже MA14', price: currentPrice };
                } else {
                    return { signal: 'NEUTRAL', reason: 'Нет подтверждения направления', price: currentPrice };
                }
            }
        }

        class StrategyManager {
            constructor() {
                this.strategies = { ma14: new MA14Strategy() };
                this.signals = [];
                this.marketData = new MarketDataManager();
                this.initializeMarketData();
            }

            initializeMarketData() {
                this.marketData.subscribe((type, data) => {
                    if (type === 'historicalData') this.analyzeHistoricalData(data);
                });

                this.marketData.loadHistoricalData().then(() => {
                    this.marketData.connectTickerWebSocket();
                });
            }

            analyzeHistoricalData(candles) {
                Object.keys(this.strategies).forEach(strategyName => {
                    const strategy = this.strategies[strategyName];
                    const result = strategy.analyze(candles);
                    this.updateStrategyUI(strategyName, result);
                    
                    if (result.signal === 'BUY' || result.signal === 'SELL') {
                        this.addSignal(strategyName, result);
                    }
                });
            }

            updateStrategyUI(strategyName, result) {
                const signalElement = document.getElementById(`${strategyName}Signal`);
                if (!signalElement) return;

                signalElement.className = 'signal-indicator';
                
                if (result.signal === 'BUY') {
                    signalElement.className += ' signal-buy';
                    signalElement.textContent = `🟢 BUY ${result.price.toFixed(2)}`;
                } else if (result.signal === 'SELL') {
                    signalElement.className += ' signal-sell';
                    signalElement.textContent = `🔴 SELL ${result.price.toFixed(2)}`;
                } else {
                    signalElement.className += ' signal-neutral';
                    signalElement.textContent = `⚪ ${result.signal}`;
                }
            }

            addSignal(strategyName, result) {
                const signal = {
                    id: Date.now(), timestamp: Date.now(), symbol: this.marketData.currentSymbol,
                    strategy: strategyName, signal: result.signal, price: result.price, reason: result.reason
                };

                this.signals.unshift(signal);
                this.updateLiveSignalsUI();
                
                if (window.db && window.firestoreUtils) {
                    window.firestoreUtils.addDoc(
                        window.firestoreUtils.collection(window.db, 'signals'), 
                        { ...signal, userId: userProfile?.firstName || 'anonymous' }
                    ).catch(console.error);
                }
            }

            updateLiveSignalsUI() {
                const container = document.getElementById('liveSignalsContainer');
                if (!container) return;
                
                const signals = this.signals.slice(0, 5);
                
                if (signals.length === 0) {
                    container.innerHTML = '<div style="color: #b8c5d1; text-align: center; padding: 20px;">Ожидание сигналов...</div>';
                    return;
                }

                let signalsHtml = '';
                signals.forEach(signal => {
                    const time = new Date(signal.timestamp).toLocaleTimeString();
                    let signalColor = signal.signal === 'BUY' ? '#00c851' : '#ff4444';
                    let signalIcon = signal.signal === 'BUY' ? '🟢' : '🔴';
                    
                    signalsHtml += `
                        <div class="signal-item" style="--signal-color: ${signalColor};">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <div style="color: ${signalColor}; font-weight: bold;">
                                    ${signalIcon} ${signal.strategy.toUpperCase()}: ${signal.signal}
                                </div>
                                <div style="color: #b8c5d1; font-size: 12px;">${time}</div>
                            </div>
                            <div style="color: #ffffff; font-size: 14px; margin-bottom: 5px;">
                                ${signal.symbol} - ${signal.price.toFixed(2)}
                            </div>
                            <div style="color: #b8c5d1; font-size: 12px;">${signal.reason}</div>
                        </div>
                    `;
                });
                
                container.innerHTML = signalsHtml;
            }

            setSymbol(symbol) { this.marketData.setSymbol(symbol); this.signals = []; this.updateLiveSignalsUI(); }
        }

        function checkAuth() {
            const savedProfile = JSON.parse(localStorage.getItem('userProfile') || 'null');
            if (savedProfile) {
                userProfile = savedProfile;
                showMainApp();
                setTimeout(initializeApp, 1000);
            }
        }

        function showMainApp() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            updateUserInterface();
        }

        function updateUserInterface() {
            if (userProfile) {
                const supportNameInput = document.getElementById('supportName');
                if (supportNameInput) {
                    supportNameInput.value = `${userProfile.firstName} ${userProfile.lastName}`;
                }
                updateUserStats();
            }
        }

        function updateUserStats() {
            if (!userProfile) return;
            
            const registrationDate = new Date(userProfile.timestamp);
            const today = new Date();
            const diffDays = Math.ceil(Math.abs(today - registrationDate) / (1000 * 60 * 60 * 24));
            
            const elements = {
                daysInSystemCount: diffDays,
                strategiesUsedCount: localStorage.getItem('strategiesUsedCount') || '0',
                userSignalsCount: localStorage.getItem('userSignalsCount') || '0'
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
        }

        function initializeApp() {
            strategyManager = new StrategyManager();
            loadNews();
            checkAdminRights();
        }

        function checkAdminRights() {
            const isAdmin = ['Shahruza', 'Admin', 'Шахруза'].includes(userProfile?.firstName);
            if (isAdmin) {
                const adminPanel = document.getElementById('adminPanel');
                if (adminPanel) adminPanel.style.display = 'block';
            }
        }

        function loadNews() {
            const newsContainer = document.getElementById('newsContainer');
            if (!newsContainer) return;
            
            const mockNews = [
                {
                    title: "Bitcoin достиг нового максимума в $67,000",
                    summary: "Криптовалютный рынок показывает сильный рост на фоне институционального интереса.",
                    date: new Date().toISOString()
                },
                {
                    title: "Ethereum готовится к крупному обновлению сети",
                    summary: "Разработчики объявили о планах внедрения новых функций масштабирования.",
                    date: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString()
                }
            ];

            let newsHtml = '';
            mockNews.forEach(news => {
                const date = new Date(news.date).toLocaleDateString('ru-RU', {
                    day: '2-digit', month: '2-digit', year: 'numeric',
                    hour: '2-digit', minute: '2-digit'
                });
                
                newsHtml += `
                    <div class="news-item">
                        <div class="news-title">${news.title}</div>
                        <div class="news-summary">${news.summary}</div>
                        <div class="news-date">${date}</div>
                    </div>
                `;
            });
            
            newsContainer.innerHTML = newsHtml;
        }

        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                birthYear: parseInt(document.getElementById('birthYear').value),
                experience: document.getElementById('experience').value,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('userProfile', JSON.stringify(formData));
            userProfile = formData;
            
            if (window.db && window.firestoreUtils) {
                try {
                    await window.firestoreUtils.addDoc(
                        window.firestoreUtils.collection(window.db, 'users'), 
                        { ...formData, createdAt: new Date(), premium: false }
                    );
                } catch (error) { console.error('Firebase error:', error); }
            }
            
            tg.sendData(JSON.stringify(formData));
            showMainApp();
            setTimeout(initializeApp, 1000);
        });

        function showPage(pageName) {
            if (pageName !== currentPage) navigationStack.push(currentPage);
            currentPage = pageName;

            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));

            document.getElementById(pageName + 'Page').classList.add('active');

            const navItems = document.querySelectorAll('.nav-item');
            const pageIndex = ['home', 'lessons', 'strategies', 'news', 'analytics', 'support'].indexOf(pageName);
            if (pageIndex !== -1 && navItems[pageIndex]) {
                navItems[pageIndex].classList.add('active');
            }

            updateBackButton();

            if (pageName === 'strategies') {
                setTimeout(() => initTradingViewChart('mainChart'), 100);
            }
        }

        // Инициализация анимации частиц для регистрации
        function initParticles() {
            const particlesContainer = document.getElementById('particles-js');
            if (!particlesContainer) return;

            // Создаем частицы программно
            for (let i = 0; i < 100; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.cssText = `
                    position: absolute;
                    width: 2px;
                    height: 2px;
                    background: rgba(79, 172, 254, ${Math.random() * 0.8 + 0.2});
                    border-radius: 50%;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    animation: particleMove ${Math.random() * 10 + 5}s linear infinite;
                    animation-delay: ${Math.random() * 5}s;
                `;
                particlesContainer.appendChild(particle);
            }

            // Добавляем CSS для анимации частиц
            const style = document.createElement('style');
            style.textContent = `
                @keyframes particleMove {
                    0% { transform: translate(0, 0) scale(0); opacity: 0; }
                    10% { opacity: 1; }
                    90% { opacity: 1; }
                    100% { transform: translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px) scale(1); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

        function updateBackButton() {
            const backBtn = document.getElementById('floatingBackBtn');
            if (backBtn) {
                backBtn.classList.toggle('show', navigationStack.length > 0);
            }
        }

        function goBack() {
            if (navigationStack.length > 0) {
                const previousPage = navigationStack.pop();
                showPage(previousPage);
            }
        }

        function selectCoin(symbol) {
            currentCoin = symbol;
            
            document.querySelectorAll('.coin-btn').forEach(btn => btn.classList.remove('active'));
            const activeCoin = document.querySelector(`[data-coin="${symbol}"]`);
            if (activeCoin) activeCoin.classList.add('active');
            
            if (strategyManager) strategyManager.setSymbol(symbol);
            setTimeout(() => initTradingViewChart('mainChart'), 100);
        }

        function showStrategy(strategyType) {
            navigationStack.push(currentPage);
            currentPage = 'strategyDetail';
            
            document.getElementById('strategiesPage').classList.remove('active');
            document.getElementById('strategyDetail').classList.add('active');

            const currentCount = parseInt(localStorage.getItem('strategiesUsedCount') || '0');
            localStorage.setItem('strategiesUsedCount', (currentCount + 1).toString());
            updateUserStats();

            const strategies = {
                ma14: {
                    title: 'MA14 - Скользящая средняя',
                    content: `
                        <p><strong>Принцип:</strong> Сравнение цены закрытия свечей с MA14</p>
                        <h3>Правила входа:</h3>
                        <ul>
                            <li><strong>🟢 BUY:</strong> 3 свечи подряд закрылись выше MA14</li>
                            <li><strong>🔴 SELL:</strong> 3 свечи подряд закрылись ниже MA14</li>
                            <li><strong>⚪ NEUTRAL:</strong> нет подтверждения направления</li>
                        </ul>
                    `
                },
                trendline: {
                    title: 'Пробой трендовой линии',
                    content: `
                        <p><strong>Принцип:</strong> Тройное движение и касания линий</p>
                        <h3>Построение:</h3>
                        <ol>
                            <li>Находим максимум, минимум, перебитый максимум</li>
                            <li>Соединяем экстремумы линией</li>
                            <li>Ждем пробоя для входа</li>
                        </ol>
                    `
                },
                channel: {
                    title: 'Трендовый канал',
                    content: `
                        <p><strong>Принцип:</strong> Параллельные линии через экстремумы</p>
                        <p>Торговля на касаниях границ канала</p>
                    `
                }
            };

            const strategy = strategies[strategyType];
            if (strategy) {
                document.getElementById('strategyDetailTitle').textContent = strategy.title;
                document.getElementById('strategyDetailContent').innerHTML = strategy.content;
            }
            
            updateBackButton();
        }

        function initTradingViewChart(containerId) {
            if (typeof TradingView !== 'undefined') {
                new TradingView.widget({
                    "width": "100%", "height": 500,
                    "symbol": `BINANCE:${currentCoin}`,
                    "interval": "15", "timezone": "Asia/Tashkent",
                    "theme": "dark", "style": "1", "locale": "ru",
                    "toolbar_bg": "#0a0e27", "enable_publishing": false,
                    "withdateranges": true, "range": "1D",
                    "hide_side_toolbar": false, "allow_symbol_change": true,
                    "studies": ["MASimple@tv-basicstudies"], "container_id": containerId,
                    "studies_overrides": { "MASimple.length": 14, "MASimple.plot.color": "#00c851" },
                    "overrides": {
                        "paneProperties.background": "#0a0e27",
                        "paneProperties.vertGridProperties.color": "#2a2f4a",
                        "paneProperties.horzGridProperties.color": "#2a2f4a",
                        "mainSeriesProperties.candleStyle.upColor": "#00c851",
                        "mainSeriesProperties.candleStyle.downColor": "#ff4444"
                    }
                });
            }
        }

        function toggleSettings() {
            const dropdown = document.getElementById('settingsDropdown');
            if (dropdown) {
                dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            }
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('selectedLanguage', lang);
            toggleSettings();
            tg.showAlert(`Язык изменен на: ${lang}`);
        }

        function setChartType(type) {
            currentChartType = type;
            localStorage.setItem('chartType', type);
            if (currentPage === 'strategies') {
                setTimeout(() => initTradingViewChart('mainChart'), 100);
            }
            tg.showAlert(`Тип графика: ${type === 'candles' ? 'Свечи' : 'Бары'}`);
            toggleSettings();
        }

        function activatePromo() {
            const promoInput = document.getElementById('promoInput');
            if (!promoInput) return;
            
            const promoCode = promoInput.value.trim();
            
            if (['TERSAAMT2024', 'PREMIUM', 'VIP'].includes(promoCode)) {
                tg.showAlert('🎉 Промокод активирован! Premium доступ получен!');
                localStorage.setItem('premiumAccess', 'true');
                promoInput.value = '';
            } else if (promoCode === '') {
                tg.showAlert('❌ Введите промокод');
            } else {
                tg.showAlert('❌ Неверный промокод');
            }
            toggleSettings();
        }

        function showFAQ() {
            toggleSettings();
            tg.showAlert(`❓ FAQ:

1. 📈 Стратегии работают с реальными данными Binance
2. 🟢🔴 Сигналы: BUY/SELL на основе анализа MA14
3. 🎁 Промокоды: TERSAAMT2024, PREMIUM, VIP
4. 📊 Все данные обновляются в реальном времени
5. 🆘 Поддержка через раздел "Поддержка"`);
        }

        function inviteFriend() {
            const inviteLink = `https://t.me/TersaaMtBot?start=${userProfile?.firstName || 'user'}_invite`;
            const message = `🚀 TersaaMt - торговые стратегии с реальными данными Binance!\n\n${inviteLink}`;
            
            if (navigator.share) {
                navigator.share({ title: 'TersaaMt', text: message, url: inviteLink });
            } else {
                navigator.clipboard?.writeText(message).then(() => {
                    tg.showAlert('Ссылка скопирована!');
                }).catch(() => {
                    tg.showAlert(`Поделитесь ссылкой:\n${inviteLink}`);
                });
            }
        }

        function showProfile() {
            if (!userProfile) {
                tg.showAlert('Профиль не загружен');
                return;
            }
            
            const experienceMap = {
                'beginner': 'Новичок (0-6 месяцев)',
                'intermediate': 'Средний (6 месяцев - 2 года)',
                'advanced': 'Продвинутый (2-5 лет)',
                'expert': 'Эксперт (5+ лет)'
            };
            
            const registrationDate = new Date(userProfile.timestamp);
            const diffDays = Math.ceil(Math.abs(new Date() - registrationDate) / (1000 * 60 * 60 * 24));
            const hasPremium = localStorage.getItem('premiumAccess') === 'true';
            const strategiesUsed = localStorage.getItem('strategiesUsedCount') || '0';
            const signalsReceived = localStorage.getItem('userSignalsCount') || '0';
            
            const profileText = `👤 ПРОФИЛЬ

Имя: ${userProfile.firstName} ${userProfile.lastName}
Год рождения: ${userProfile.birthYear}
Опыт: ${experienceMap[userProfile.experience] || userProfile.experience}

📊 СТАТИСТИКА
Дней в системе: ${diffDays}
Использовано стратегий: ${strategiesUsed}
Просмотрено уроков: ${signalsReceived}
Premium статус: ${hasPremium ? 'Активен' : 'Неактивен'}

Регистрация: ${registrationDate.toLocaleDateString('ru-RU')}`;
            
            tg.showAlert(profileText);
        }

        function playVideo(videoId) {
            const videos = {
                'basic-analysis': { title: 'Основы технического анализа', description: 'Базовые принципы с данными Bitcoin' },
                'ma14-strategy': { title: 'Стратегия MA14 в деле', description: 'Живой пример на Ethereum' },
                'risk-management': { title: 'Управление рисками', description: 'Защита капитала в торговле' }
            };

            const video = videos[videoId];
            if (video) {
                const currentCount = parseInt(localStorage.getItem('userSignalsCount') || '0');
                localStorage.setItem('userSignalsCount', (currentCount + 1).toString());
                updateUserStats();
                
                tg.showAlert(`▶️ ${video.title}\n\n${video.description}\n\n(В полной версии здесь будет интерактивное видео с реальными котировками)`);
            }
        }

        function showLiveSignals() {
            if (!strategyManager || strategyManager.signals.length === 0) {
                tg.showAlert('Нет активных сигналов');
                return;
            }
            
            let message = '🔴 ЖИВЫЕ СИГНАЛЫ:\n\n';
            strategyManager.signals.slice(0, 5).forEach(signal => {
                const time = new Date(signal.timestamp).toLocaleTimeString();
                message += `${time} - ${signal.strategy.toUpperCase()}: ${signal.signal} ${signal.price.toFixed(2)}\n`;
            });
            
            tg.showAlert(message);
        }

        function exportData() {
            try {
                const data = {
                    signals: strategyManager ? strategyManager.signals : [],
                    userProfile: userProfile,
                    timestamp: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `tersaamt_data_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                tg.showAlert('Данные экспортированы');
            } catch (error) {
                console.error('Ошибка экспорта:', error);
                tg.showAlert('Ошибка экспорта данных');
            }
        }

        document.getElementById('supportForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const supportData = {
                name: document.getElementById('supportName').value,
                subject: document.getElementById('supportSubject').value,
                description: document.getElementById('supportDescription').value,
                userProfile: userProfile,
                timestamp: new Date().toISOString()
            };

            try {
                if (window.db && window.firestoreUtils) {
                    await window.firestoreUtils.addDoc(
                        window.firestoreUtils.collection(window.db, 'support_requests'), 
                        supportData
                    );
                }
            } catch (error) {
                console.error('Ошибка сохранения запроса:', error);
            }

            tg.sendData(JSON.stringify(supportData));
            tg.showAlert('Ваш запрос отправлен! Мы свяжемся с вами.');
            e.target.reset();
            
            document.getElementById('supportName').value = `${userProfile?.firstName || ''} ${userProfile?.lastName || ''}`.trim();
        });

        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('settingsDropdown');
            const settingsBtn = document.querySelector('.settings-btn');
            
            if (dropdown && settingsBtn && !dropdown.contains(e.target) && !settingsBtn.contains(e.target)) {
                dropdown.style.display = 'none';
            }
        });

        if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
            const telegramUser = window.Telegram.WebApp.initDataUnsafe.user;
            
            if (telegramUser.first_name) {
                const firstNameInput = document.getElementById('firstName');
                if (firstNameInput) firstNameInput.value = telegramUser.first_name;
            }
            if (telegramUser.last_name) {
                const lastNameInput = document.getElementById('lastName');
                if (lastNameInput) lastNameInput.value = telegramUser.last_name;
            }
        }

        window.addEventListener('load', () => {
            checkAuth();
            initParticles(); // Инициализация анимации частиц для регистрации
            
            const savedLanguage = localStorage.getItem('selectedLanguage');
            if (savedLanguage) currentLanguage = savedLanguage;
            
            const savedChartType = localStorage.getItem('chartType');
            if (savedChartType) currentChartType = savedChartType;
        });

        window.addEventListener('DOMContentLoaded', () => {
            console.log('TersaaMt Loading...');
            
            setTimeout(() => {
                if (document.getElementById('mainChart')) {
                    initTradingViewChart('mainChart');
                }
            }, 2000);
        });

        console.log('TersaaMt Trading App v8.0 - С анимированным фоном и новой навигацией готова! 🚀');
    </script>
</body>
</html>
